# 信息收集

## Linux

### 系统版本

快速获取 Linux 系统发行版。



查看 **/etc/os-release** 文件（最推荐）

```
cat /etc/os-release
```

```
NAME="Ubuntu"
VERSION="20.04.3 LTS (Focal Fossa)"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu 20.04.3 LTS"
VERSION_ID="20.04"
```



检查 **/etc/issue** 或 **/etc/issue.net**

```
cat /etc/issue
cat /etc/issue.net
```

```
Ubuntu 24.04.2 LTS \n \l
```

```
Ubuntu 24.04.2 LTS
```



**lsb_release**命令（需安装lsb-core）

```
lsb_release -a
```

```
Distributor ID: Ubuntu
Description:    Ubuntu 20.04.3 LTS
Release:        20.04
Codename:       focal
```



**lsb-release 文件**

```
cat /etc/lsb-release
```

- 这是 **Ubuntu** 特有的文件，其他发行版可能没有。



发行版特定文件（备用方案）

**RedHat / CentOS**

```
cat /etc/redhat-release
```



**Debian**

```
cat /etc/debian_version
```



**Arch Linux**

```
cat /etc/arch-release
```



**Alpine**

```
cat /etc/alpine-release
```



**检查内核版本**（辅助确认）

```
uname -a
```

```
Linux deng-hk 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux
```



```
cat /proc/version
```

```
Linux version 6.8.0-53-generic (buildd@lcy02-amd64-046) (x86_64-linux-gnu-gcc-13 (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0, GNU ld (GNU Binutils for Ubuntu) 2.42) #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025
```



### 主机环境

通过多种方法判断当前环境是 **物理机（裸金属）**、**虚拟机（KVM、VMware、Hyper-V 等）**、**容器（Docker、LXC 等）** 还是**其他环境**。



#### 虚拟化

检查虚拟化环境（**KVM、VMware、Hyper-V 等**）

使用 systemd-detect-virt（推荐）

```
systemd-detect-virt
```

**可能的输出**：

- `none` → **物理机（裸金属）**
- `kvm` → **KVM 虚拟机**
- `vmware` → **VMware 虚拟机**
- `hyperv` → **Hyper-V 虚拟机**
- `qemu` → **QEMU 虚拟机**
- `xen` → **Xen 虚拟机**
- `lxc` → **LXC 容器**
- `docker` → **Docker 容器**
- `wsl` → **Windows Subsystem for Linux (WSL)**



检查 /proc/cpuinfo 或 dmesg

```
grep -E "hypervisor|vmx|svm" /proc/cpuinfo
```

- 如果输出包含 `hypervisor`，说明是虚拟机。
- 如果包含 `vmx`（Intel）或 `svm`（AMD），说明 CPU 支持虚拟化（可能是宿主机或嵌套虚拟化）。



检查 /sys/class/dmi/id/（BIOS 信息）

```
cat /sys/class/dmi/id/product_name
```

**可能的输出**：

- `VMware Virtual Platform` → VMware 虚拟机
- `KVM` → KVM 虚拟机
- `VirtualBox` → VirtualBox 虚拟机
- `Bochs` → QEMU/Bochs 虚拟机
- 物理机通常显示主板型号（如 `PowerEdge R740`）



检查 lscpu

```
lscpu | grep -i hypervisor
```

如果输出 Hypervisor vendor: KVM 或类似信息，说明是虚拟机。



#### 容器

检测容器环境**（Docker、LXC、Kubernetes 等）**

检查 /proc/1/cgroup

```
cat /proc/1/cgroup
```

**可能的输出**：

- `docker` → **Docker 容器**
- `lxc` → **LXC 容器**
- `kubepods` → **Kubernetes Pod**
- `system.slice` → 可能是 **物理机或虚拟机**
- `/.dockerenv` 文件存在 → **Docker 容器**



检查 mount 信息

```
mount | grep -i "overlay\|aufs"
```

- 如果使用 `overlay` 或 `aufs` 存储驱动，可能是容器。

- 如果不存在该命令，可以直接读取 **/proc/mounts、/proc/self/mountinfo** 文件。



检查 hostname

```
hostname
```

- 如果是随机字符串（如 `f3a1b2c3d4e5`），可能是容器。



#### WSL

检测 WSL（Windows Subsystem for Linux）

```
uname -a | grep -i microsoft
```

```
cat /proc/version | grep -i microsoft
```

- 如果输出包含 `Microsoft` 或 `WSL`，说明是 WSL 环境。



